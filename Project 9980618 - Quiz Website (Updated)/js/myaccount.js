function populateProfile(){$("#myAccountProfileImageUsername").val(userInfo.username),""!==userInfo.imageURL?($("#myAccountProfileImage").prop("src","./images/users/"+userInfo.imageURL),$("#myAccountProfileImage").show(),$("#myAccountProfileImageForm").show(),$("#myAccountRemoveProfileImageButton").show()):($("#myAccountProfileImage").prop("src","./images/users/missing.png"),$("#myAccountProfileImage").show(),$("#myAccountProfileImageForm").show(),$("#myAccountRemoveProfileImageButton").hide()),showProfileView(),$("#profileEditButton").on("click",showProfileEdit),$("#profileSaveButton").on({click:function(){isPancardValid($("#myAccountProfilePancard").val())?(userInfo.firstName=$("#myAccountProfileFirstName").val(),userInfo.lastName=$("#myAccountProfileLastName").val(),userInfo.gender=$("#myAccountProfileGender").val(),userInfo.DOB=$("#myAccountProfileDOB").val(),userInfo.mobileAlt=$("#myAccountProfileMobileAlt").val(),userInfo.address=$("#myAccountProfileAddress").val(),userInfo.city=$("#myAccountProfileCity").val(),userInfo.pincode=$("#myAccountProfilePincode").val(),userInfo.state=$("#myAccountProfileState").val(),userInfo.country=$("#myAccountProfileCountry").val(),userInfo.pancard=$("#myAccountProfilePancard").val(),$.post("./php/users/updateuserprofile.php",{username:sessionStorage.username,firstName:userInfo.firstName,lastName:userInfo.lastName,gender:userInfo.gender,DOB:userInfo.DOB,mobileAlt:userInfo.mobileAlt,address:userInfo.address,city:userInfo.city,pincode:userInfo.pincode,state:userInfo.state,country:userInfo.country,pancard:userInfo.pancard},function(e){"success"===e?(displayMessage("info","Profile Saved","Your profile has been saved"),showProfileView()):displayMessage("error","Error","Error saving your profile changes. Please contact the web admin to notify them of this problem")}).fail(function(){})):displayMessage("warning","Invalid Pancard","The pancard entered is invalid. The valid format is 5 letters then 4 numbers then 1 letter.")}})}function showProfileEdit(){$("#myAccountProfileFirstName").val(userInfo.firstName),$("#myAccountProfileLastName").val(userInfo.lastName),$("#myAccountProfileEmail").val(userInfo.email),$("#myAccountProfileGender").val(userInfo.gender),$("#myAccountProfileDOB").val(userInfo.DOB),$("#myAccountProfileMobile").val(userInfo.mobile),$("#myAccountProfileMobileAlt").val(userInfo.mobileAlt),$("#myAccountProfileAddress").text(userInfo.homeAddress),$("#myAccountProfileCity").val(userInfo.city),$("#myAccountProfilePincode").val(userInfo.pincode),$("#myAccountProfileState").val(userInfo.state),$("#myAccountProfileCountry").val(userInfo.country),$("#myAccountProfilePancard").val(userInfo.pancard),$("#myAccountProfileEmail").prop("disabled",!0),$("#myAccountProfileMobile").prop("disabled",!0),""!==userInfo.pancard&&$("#myAccountProfilePancard").prop("disabled",!0),$("#profileView").hide(),$("#profileEdit").show(),window.scrollTo(0,0)}function showProfileView(){$("#myAccountProfileFirstNameView").text(userInfo.firstName),$("#myAccountProfileLastNameView").text(userInfo.lastName),$("#myAccountProfileEmailView").text(userInfo.email),$("#myAccountProfileGenderView").text(userInfo.gender),$("#myAccountProfileDOBView").text(userInfo.DOB),$("#myAccountProfileMobileView").text(userInfo.mobile),$("#myAccountProfileMobileAltView").text(userInfo.mobileAlt),$("#myAccountProfileAddressView").text(userInfo.homeAddress),$("#myAccountProfileCityView").text(userInfo.city),$("#myAccountProfilePincodeView").text(userInfo.pincode),$("#myAccountProfileStateView").text(userInfo.state),$("#myAccountProfileCountryView").text(userInfo.country),$("#myAccountProfilePancardView").text(userInfo.pancard),$("#profileView").show(),$("#profileEdit").hide(),window.scrollTo(0,0)}function tidyColumnName(e){switch(e){case"firstName":return"first name";case"lastName":return"last name";case"homeAddress":return"home address";case"mobileAlt":return"alternate mobile number";case"gender":return"gender";case"DOB":return"date of birth";case"city":return"city";case"pincode":return"pincode";case"state":return"state";case"country":return"country"}}function removeProfilePicture(){$.post("./php/users/removeprofilepicture.php",{username:sessionStorage.username},function(e){"success"===e?($("#myAccountProfileImage").prop("src","./images/users/missing.png"),displayMessage("info","","Your profile picture has been removed")):displayMessage("error","","There was a problem removing your profile picture. Please contact the web admin to inform them of this problem")}).fail(function(){})}function populateQuizzes(){var e="";e+="<div class='tablePaginationContainer' id='myAccountQuizPagination'>";for(var t=0;quizResults.length>20&&t<quizResults.length/20;t+=1)e+="<button class='paginationButton"+t+"' onclick='changeQuizPage("+t+")'>"+(t+1)+"</button>";e+="</div>",e+="<table id='quizzesHistory'>",e+="    <tr>",e+="        <th>Quiz Name</th>",e+="        <th>Registration Fee</th>",e+="        <th>Rank</th>",e+="    </tr>";for(var s=20*tablePages.quizzes;null!==quizResults&&s<quizResults.length&&s<20*(tablePages.quizzes+1);s+=1){var i=quizResults[s];e+="    <tr>",e+="        <td>"+i.name+"</td>",e+="        <td>"+i.fee+"</td>",e+="        <td>"+(""===i.userRank?"Quiz hasn't finished":i.userRank)+"</td>",e+="    </tr>"}e+="</table>",$("#myAccountQuizzes").empty().append(e),$("#myAccountQuizPagination .paginationButton"+tablePages.quizzes).addClass("active")}function populateWithdrawals(){for(var e="",t=0;withdrawals.length>20&&t<withdrawals.length/20;t+=1)e+="<button class='paginationButton"+t+"' onclick='changeWithdrawalPage("+t+")'>"+(t+1)+"</button>";$("#myAccountWithdrawalsPagination").empty().append(e),$("#myAccountWithdrawalsPagination .paginationButton"+tablePages.withdrawals).addClass("active");var s="";s+="<table id='withdrawalHistory'>",s+="    <tr>",s+="        <th>Date</th>",s+="        <th>Amount</th>",s+="        <th>Method</th>",s+="        <th>Processed</th>",s+="    </tr>";for(var i=20*tablePages.withdrawals;null!==withdrawals&&i<withdrawals.length&&i<20*(tablePages.withdrawals+1);i+=1){var o=withdrawals[i];s+="    <tr>",s+="        <td>"+moment(o.time).format("Do MMM YYYY h:mm a")+"</td>",s+="        <td>₹"+o.amount+"</td>",s+="        <td>"+o.method+"</td>",s+="        <td>"+("y"===o.done?"Yes":"No")+"</td>",s+="    </tr>"}s+="</table>",$("#myAccountWithdrawHistory").empty().append(s)}function populatePurchases(){for(var e="",t=0;purchaseHistory.length>20&&t<purchaseHistory.length/20;t+=1)e+="<button class='paginationButton"+t+"' onclick='changePurchasePage("+t+")'>"+(t+1)+"</button>";$("#myAccountPurchasePagination").empty().append(e),$("#myAccountPurchasePagination .paginationButton"+tablePages.purchase).addClass("active");var s="";s+="<table id='purchasesHistory'>",s+="    <tr>",s+="        <th>Date</th>",s+="        <th>Amount</th>",s+="    </tr>";for(var i=20*tablePages.purchase;null!==purchaseHistory&&i<purchaseHistory.length&&i<20*(tablePages.purchase+1);i+=1){var o=purchaseHistory[i];s+="    <tr>",s+="        <td>"+moment(o.datePurchased).format("Do MMM YYYY h:mm a")+"</td>",s+="        <td>₹"+o.amount+"</td>",s+="    </tr>"}s+="</table>",$("#myAccountPurchaseHistory").empty().append(s)}function populateTaxations(){var e="";e+="<div class='tablePaginationContainer' id='myAccountTaxationPagination'>";for(var t=0;taxations.length>20&&t<taxations.length/20;t+=1)e+="<button class='paginationButton"+t+"' onclick='changeTaxationPage("+t+")'>"+(t+1)+"</button>";e+="</div>",e+="<table id='myAccountTaxationTable'>",e+="    <tr>",e+="        <th>Quizetos Won</th>",e+="        <th>Tax Amount</th>",e+="        <th>Net Quizetos</th>",e+="    </tr>";for(var s=20*tablePages.taxation;null!==taxations&&s<taxations.length&&s<20*(tablePages.taxation+1);s+=1){var i=taxations[s];e+="    <tr>",e+="        <td>"+i.grossQuizetos+"</td>",e+="        <td>"+i.taxAmount+"</td>",e+="        <td>"+i.netQuizetos+"</td>",e+="    </tr>"}e+="</table>",$("#myAccountTaxation").empty().append(e),$("#myAccountTaxation .paginationButton"+tablePages.taxation).addClass("active")}function hideAllContainers(){$("#myAccountProfile").hide(),$("#myAccountBuy").hide(),$("#myAccountChangePassword").hide(),$("#myAccountConversion").hide(),$("#myAccountWithdraw").hide(),$("#myAccountQuizzes").hide(),$("#myAccountTaxation").hide(),$("#myAccountQuizMaster").hide()}function areSamePassword(){return""!==$("#confirmPassword").val()&&""!==$("#newPassword").val()?$("#confirmPassword").val()!==$("#newPassword").val()?($("#confirmPassword").css("border",red),$("#newPassword").css("border",red),$("<span class='message'>The passwords don't match</span>").insertAfter("#confirmPassword"),setTimeout(function(){$(".message").remove()},2e3),!1):($("#confirmPassword").css("border",green),$("#newPassword").css("border",green),!0):!1}function changePassword(){areSamePassword()&&currentPasswordCorrect?$.post("./php/users/changepassword.php",{username:sessionStorage.username,newPassword:$("#newPassword").val()},function(e){"success"===e?displayMessage("info","Password Changed","Your password has been changed successfully."):displayMessage("error","Error","Error: "+e)}).fail(function(){}):displayMessage("warning","","Please make sure your current password is correct and the passwords entered in the other text boxes are the same.")}function changeEmail(){$.post("./php/users/changeemail.php",{username:sessionStorage.username,email:$("#newEmail").val(),emailCode:createEmailCode()},function(e){"success"===e?displayMessage("info","","Your email has been changed and a verification email has been sent to your new email."):displayMessage("error","Error","Error: "+e)}).fail(function(){})}function showProfile(){hideAllContainers(),$("#myAccountProfile").show()}function showChangePassword(){hideAllContainers(),$("#myAccountChangePassword").show()}function showQuizzes(){hideAllContainers(),$("#myAccountQuizzes").show()}function showDeposit(){hideAllContainers(),$("#myAccountBuy").show()}function showConversion(){hideAllContainers(),$("#myAccountConversion").show()}function showWithdraw(){if("y"===sessionStorage.emailVerified)hideAllContainers(),$("#myAccountWithdraw").show();else{var e=prompt("You haven't verified your email. You can either enter your email below or click the link in the welcome email you received.");null!==e&&$.post("./php/users/checkemailredeem.php",{userID:sessionStorage.userID,email:e},function(t){"exists"===t?$.post("./php/users/sendverificationemail.php",{userID:sessionStorage.userID,email:e,code:createEmailCode()},function(e){"success"===e?displayMessage("info","Verification Email Sent","A verification email has been sent to the entered email address. Please click it to be allowed to redeem your real quizetos for money."):displayMessage("error","Error","Err or sending verification email. Please try again.")}).fail(function(){}):"notexists"===t?displayMessage("warning","Incorrect Email","The email entered doesn't match the email attached to your account."):displayMessage("error","Error","Err or checking email. Please try again.")}).fail(function(){})}}function showTaxation(){hideAllContainers(),$("#myAccountTaxation").show()}function displayPaymentGateway(){$("#numQuizetos").val()%50===0?(options.amount=100*parseInt($("#numQuizetos").val()),options.notes.userID=sessionStorage.userID,options.notes.username=sessionStorage.username,rzp1=new Razorpay(options),rzp1.open(),e.preventDefault()):displayMessage("warning","","You can only purchase quizetos in multiples of 50")}function convertFreePoints(){$.post("./php/users/convertpoints.php",{userID:sessionStorage.userID,username:sessionStorage.username,freePoints:$("#numFreeQuizetos").val()},function(e){"success"===e.substr(0,7)?(updatePoints(),displayMessage("info","Conversion Successful",e.substr(7)+" Bonus Quizetos have been converted to Real Quizetos")):"notenoughpoints"===e?(updatePoints(),displayMessage("warning","Insufficient Qzuietos","You don't have enough bonus quizetos. Please enter a amount lower than the amount in the header.")):displayMessage("error","Error","Error converting Bonus quizetos to Real quizetos. Please contact the web admin to inform them of this problem")}).fail(function(){})}function redeemRealPoints(e){"cheque"===e?"none"==$("#withdrawChequeAddress").css("display")?($("#withdrawChequeAddress").slideDown(),$("#withdrawBankTransferDetails").slideUp()):$("#withdrawChequeAddress").slideUp():"banktransfer"===e&&("none"==$("#withdrawBankTransferDetails").css("display")?($("#withdrawBankTransferDetails").slideDown(),$("#withdrawChequeAddress").slideUp()):$("#withdrawBankTransferDetails").slideUp())}function submitCheque(){var e=areInputsValidCheque();if(e[0]){var t=sessionStorage.username,s=$("#numRealRedeemQuizetos").val(),i=$("#withdrawChequeAddressName").val(),o=$("#withdrawChequePhone").intlTelInput("getNumber"),a="";a+=$("#withdrawChequeAddress1").val()?$("#withdrawChequeAddress1").val():"",a+=$("#withdrawChequeAddress2").val()?", "+$("#withdrawChequeAddress2").val():"",a+=$("#withdrawChequeAddress3").val()?", "+$("#withdrawChequeAddress3").val():"",a+=$("#withdrawChequeAddress4").val()?", "+$("#withdrawChequeAddress4").val():"";var n=$("#withdrawChequePancard").val();$.post("./php/withdrawals/redeemCheque.php",{username:t,name:i,address:a,phone:o,amount:s,pancard:n,method:"Cheque"},function(e){"success"===e?(displayMessage("info","Redeem Successful","Your redeem request for the amount "+s+" has been received and will be processed in 10 working days"),updatePoints()):"notenoughpoints"===e?displayMessage("info","Insufficient Quizetos","You tried redeeming more points than you have. Please try redeeming a smaller amount."):displayMessage("error","Error","Err or sending redeem request. Please try again later.")}).fail(function(){})}else displayMessage("warning","Problem redeeming",e[1])}function submitBankTransfer(){var e=areInputsValidBankTransfer();if(e[0]){var t=sessionStorage.username,s=$("#numRealRedeemQuizetos").val(),i=$("#withdrawBankTransferName").val(),o=$("#withdrawBankTransferPhone").intlTelInput("getNumber"),a=$("#withdrawBankTransferAccountNumber").val(),n=$("#withdrawBankTransferCode").val(),r=$("#withdrawChequePancard").val();$.post("./php/withdrawals/redeemBankTransfer.php",{username:t,name:i,accountNum:a,code:n,phone:o,amount:s,pancard:r,method:"Bank Transfer"},function(e){"success"===e?(displayMessage("info","Redeem Successful","Your redeem request for the amount "+s+" has been received and will be processed in 10 working days"),updatePoints()):"notenoughpoints"===e?displayMessage("info","Insufficient Quizetos","You tried redeeming more points than you have. Please try redeeming a smaller amount."):displayMessage("error","Error","Err or sending redeem request. Please try again later.")}).fail(function(){})}else displayMessage("warning","Problem redeeming",e[1])}function areInputsValidCheque(){return isPancardCorrect?isMobileNumberCorrect?""===$("#numRealRedeemQuizetos").val()?[!1,"Please enter an amount of Quizetos you want to redeem."]:""===$("#withdrawChequeAddress1").val()&&""===$("#withdrawChequeAddress2").val()&&""===$("#withdrawChequeAddress3").val()&&""===$("#withdrawChequeAddress3").val()?[!1,"Please enter an address to send the cheque to."]:[!0]:[!1,"The phone number you entered doesn't match the number with your account. Make sure you choose the correct country from the dropdown"]:[!1,"The pancard you entered doesn't match the pancard with your account."]}function areInputsValidBankTransfer(){return isPancardCorrect?isMobileNumberCorrect?""===$("#numRealRedeemQuizetos").val()?[!1,"Please enter an amount of Quizetos you want to redeem."]:11!==$("#withdrawBankTransferCode").val().length?[!1,"The IFSC code you entered is invalid."]:""===$("#withdrawBankTransferName").val()?[!1,"Please enter your name."]:""===$("#withdrawBankTransferAccountNumber").val()?[!1,"Please enter a bank account number."]:[!0]:[!1,"The phone number you entered doesn't match the number with your account. Make sure you choose the correct country from the dropdown"]:[!1,"The pancard you entered doesn't match the pancard with your account."]}function checkMobileCheque(){$.post("./php/users/checkmobile.php",{userID:sessionStorage.userID,mobile:$("#withdrawChequePhone").intlTelInput("getNumber")},function(e){"correct"===e?($("#withdrawChequePhone").css("border",green).attr("title","This number matches the number associated with your account."),isMobileNumberCorrect=!0):($("#withdrawChequePhone").css("border",red).attr("title","This number doesn't matches the number associated with your account."),isMobileNumberCorrect=!1)})}function checkMobileBankTransfer(){$.post("./php/users/checkmobile.php",{userID:sessionStorage.userID,mobile:$("#withdrawBankTransferPhone").intlTelInput("getNumber")},function(e){"correct"===e?($("#withdrawBankTransferPhone").css("border",green).attr("title","This number matches the number associated with your account."),isMobileNumberCorrect=!0):($("#withdrawBankTransferPhone").css("border",red).attr("title","This number doesn't matches the number associated with your account."),isMobileNumberCorrect=!1)})}function checkPancardCheque(){isPancardValid($("#withdrawChequePancard").val())?""!==userInfo.pancard&&$("#withdrawChequePancard").val()!==userInfo.pancard?($("#withdrawChequePancard").css("border",red).attr("title","This pancard doesn't matches the number associated with your account."),isPancardCorrect=!1):($("#withdrawChequePancard").css("border",green).attr("title","This pancard matches the number associated with your account."),isPancardCorrect=!0):($("#withdrawChequePancard").css("border",red).attr("title","This pancard is invalid. The correct format is 5 letters then 4 numbers then 1 letter"),isPancardCorrect=!1)}function checkPancardBankTransfer(){isPancardValid($("#withdrawBankTransferPancard").val())?""!==userInfo.pancard&&$("#withdrawBankTransferPancard").val()!==userInfo.pancard?($("#withdrawBankTransferPancard").css("border",red).attr("title","This pancard doesn't matches the number associated with your account."),isPancardCorrect=!1):($("#withdrawBankTransferPancard").css("border",green).attr("title","This pancard matches the number associated with your account."),isPancardCorrect=!0):($("#withdrawBankTransferPancard").css("border",red).attr("title","This pancard is invalid. The correct format is 5 letters then 4 numbers then 1 letter"),isPancardCorrect=!1)}function isPancardValid(e){return 0===e.length||10===e.length&&-1===e.substr(0,5).search(/[0-9]/)&&!isNaN(e.substr(5,4))&&-1===e.substr(9).search(/[0-9]/)?!0:!1}function changeQuizPage(e){tablePages.quizzes=e,populateQuizzes()}function changePurchasePage(e){tablePages.purchase=e,populatePurchases()}function changeWithdrawalPage(e){tablePages.withdrawals=e,populateWithdrawals()}function changeTaxationPage(e){tablePages.taxation=e,populateTaxations()}function showQuizMaster(){hideAllContainers(),$("#myAccountQuizMaster").show()}function populateQuizMaster(){var e="";e+="<button onclick='showQuizMasterInfo()'>Activate as Quiz Master</button>",e+="<button onclick='showUserInfo()'>Activate as User</button>",e+="<button onclick='showUploadQuestion()'>Upload Question</button>",e+="<button id='quizMasterScheduleButton' onclick='showScheduleQuiz()'>Schedule Quiz</button>",$("#quizMasterSideNav").html(e);var t,s,i,o="";"y"===sessionStorage.quizMaster?!0:!1;t=quizMasterInfo.numQuizzesPurchased,s=quizMasterInfo.numQuizzesScheduledQuizMaster,i=t-s,o+="<table id='quizMasterQuizMasterInfo'>",o+="    <tr>",o+="        <th>Number of quiz purchased</th>",o+="        <th>Number of quiz already scheduled</th>",o+="        <th>Number of quiz left to schedule</th>",o+="        <th>Number of questions approved</th>",o+="        <th>Number of questions rejected</th>",o+="    </tr>",o+="    <tr>",o+="        <td>"+t+"</td>",o+="        <td data-toggle='modal' data-target='#previousQuizModal'>"+s+"</td>",o+="        <td>"+i+"</td>",o+="        <td>"+quizMasterInfo.approvedQuestionCount+"</td>",o+="        <td data-toggle='modal' data-target='#rejectedQuestionModal'>"+rejectedQuestions.length+"</td>",o+="    </tr>",o+="</table>","0"===quizMasterInfo.quizScheduleTarget?(t="Unlimited",s=quizMasterInfo.numQuizzesScheduledUser,i="Unlimited"):(t=parseInt(quizMasterInfo.numQuizzesScheduledUser)+Math.floor(quizMasterInfo.numQuizzesTakenRemaining/quizMasterInfo.quizScheduleTarget),s=quizMasterInfo.numQuizzesScheduledUser,i=t-s),o+="<table id='quizMasterUserInfo'>",o+="    <tr>",o+="        <th>Number of Paid Quizzes Played</th>",o+="        <th>Number of quiz which can be scheduled</th>",o+="        <th>Number of quiz already scheduled</th>",o+="        <th>Number of quiz left to schedule</th>",o+="        <th>Number of questions approved</th>",o+="        <th>Number of questions rejected</th>",o+="    </tr>",o+="    <tr>",o+="        <td>"+quizMasterInfo.numQuizzesTaken+"</td>",o+="        <td>"+t+"</td>",o+="        <td data-toggle='modal' data-target='#previousQuizModal'>"+s+"</td>",o+="        <td>"+i+"</td>",o+="        <td>"+quizMasterInfo.approvedQuestionCount+"</td>",o+="        <td data-toggle='modal' data-target='#rejectedQuestionModal'>"+rejectedQuestions.length+"</td>",o+="    </tr>",o+="</table>",o+="<table id='quizMasterQuestionSubmission'>",o+="    <tr>",o+="        <th>Question</th>",o+="        <th>Answer 1</th>",o+="        <th>Answer 2</th>",o+="        <th>Answer 3</th>",o+="        <th>Answer 4</th>",o+="        <th>Correct Answer</th>",o+="    </tr>";for(var a=0;10>a;a+=1)o+="<tr id='question"+a+"'>",o+="    <td contenteditable='true'></td>",o+="    <td contenteditable='true'></td>",o+="    <td contenteditable='true'></td>",o+="    <td contenteditable='true'></td>",o+="    <td contenteditable='true'></td>",o+="    <td>",o+="        <select>",o+="            <option value=''></option>",o+="            <option value='0'>Answer 1</option>",o+="            <option value='1'>Answer 2</option>",o+="            <option value='2'>Answer 3</option>",o+="            <option value='3'>Answer 4</option>",o+="        </select>",o+="    </td>",o+="</tr>";o+="    <tr>",o+="        <td colspan='6'><button onclick='submitQuestions()'>Submit Questions</button></td>",o+="    </tr>",o+="</table>",o+="<div id='quizMasterScheduleQuiz'>",o+="    <div>",o+="        <label for='#quizMasterQuizName'>Name:</label>",o+="        <input id='quizMasterQuizName' type='text'>",o+="    </div>",o+="    <div>",o+="        <label for='#quizMasterQuizMinUsers'>Minimum number of user needed:</label>",o+="        <input id='quizMasterQuizMinUsers' type='number'>",o+="    </div>",o+="    <div>",o+="        <label for='#quizMasterQuizFee'>Registration fee:</label>",o+="        <input id='quizMasterQuizFee' type='number' min='50'>",o+="    </div>",o+="    <div>",o+="        <label for='#quizMasterQuizDate'>Date:</label>",o+="        <div id='quizMasterQuizDate'></div>",o+="    </div>",o+="    <div>",o+="        <label>Start time:</label><br />",o+="        <table id='quizMasterQuizStartTimeTable'>";for(var n=0;24>n;n+=1){o+="        <tr>";for(var r=0;6>r;r+=1)o+="        <td class='ts"+pad(n,2)+pad(10*r,2)+"' onclick='selectTimeSlot(this)'>"+(n>12?n-12:0===n?12:n)+":"+pad(10*r,2)+(n>11?"pm":"am")+"</td>";o+="        </tr>"}o+="        </table>",o+="    </div>",o+="    <div>",o+="        <button onclick='scheduleQuiz()'>Schedule Quiz</label>",o+="    </div>",o+="</div>",$("#quizMasterContent").html(o),$("#quizMasterQuizDate").datetimepicker({format:"dd/MM/YYYY",inline:!0}),$("#quizMasterQuizDate").on("dp.change",function(){disableTimeSlots()}),disableTimeSlots();var u="";u+="<table id='quizMasterPreviouslyScheduledQuizzes'>",u+="    <tr>",u+="        <th>Quiz Name</th>",u+="        <th>Date</th>",u+="        <th>Start Time</th>",u+="        <th>Total registered users</th>",u+="        <th>Registration Fee</th>",u+="        <th>Winner</th>",u+="        <th>Earnings</th>",u+="    </tr>",quizMasterInfo.previouslyScheduledQuizzes.forEach(function(e){var t=moment(e.startTime).format("ddd Do MMM YY"),s=moment(e.startTime).format("H:mm a"),i=JSON.parse(e.userRegistered).length,o=i*e.pointsCost*(e.creatorEarnings/100);u+="<tr>",u+="    <td>"+e.category+"</td>",u+="    <td>"+t+"</td>",u+="    <td>"+s+"</td>",u+="    <td>"+i+"</td>",u+="    <td>"+e.pointsCost+"</td>",u+="    <td>"+(null===e.winner?"Hasn't Finished":e.winner)+"</td>",u+="    <td>"+o+"</td>",u+="</tr>"}),u+="</table>",$("#previousQuizModal .modal-body").empty().append(u);var d="";d+="<table id='quizMasterRejectedQuestions'>",d+="    <tr>",d+="        <th>Question</th>",d+="        <th>Answer 1</th>",d+="        <th>Answer 2</th>",d+="        <th>Answer 3</th>",d+="        <th>Answer 4</th>",d+="        <th>Correct Answer</th>",d+="    </tr>",rejectedQuestions.forEach(function(e){var t=JSON.parse(e.question);d+="<tr>",d+="    <td>"+t[0]+"</td>",d+="    <td>"+t[1][0]+"</td>",d+="    <td>"+t[1][1]+"</td>",d+="    <td>"+t[1][2]+"</td>",d+="    <td>"+t[1][3]+"</td>",d+="    <td>Answer "+(parseInt(t[2])+1)+"</td>",d+="</tr>"}),d+="</table>",$("#rejectedQuestionModal .modal-body").empty().append(d)}function showQuizMasterInfo(){"none"==$("#quizMasterQuizMasterInfo").css("display")?($("#quizMasterQuizMasterInfo").show(),$("#quizMasterUserInfo").hide(),$("#quizMasterQuestionSubmission").hide(),$("#quizMasterScheduleQuiz").hide(),$("#quizMasterScheduleButton").show(),sessionStorage.quizMaster="true"):$("#quizMasterQuizMasterInfo").hide()}function showUserInfo(){"none"==$("#quizMasterUserInfo").css("display")?($("#quizMasterQuizMasterInfo").hide(),$("#quizMasterUserInfo").show(),$("#quizMasterQuestionSubmission").hide(),$("#quizMasterScheduleQuiz").hide(),$("#quizMasterScheduleButton").show(),sessionStorage.quizMaster="false"):$("#quizMasterUserInfo").hide()}function showUploadQuestion(){"none"==$("#quizMasterQuestionSubmission").css("display")?($("#quizMasterQuestionSubmission").show(),$("#quizMasterScheduleQuiz").hide(),$("#quizMasterUserInfo").hide(),$("#quizMasterQuizMasterInfo").hide()):$("#quizMasterQuestionSubmission").hide()}function showScheduleQuiz(){var e,t="true"==sessionStorage.quizMaster?!0:!1;e=t?$("#quizMasterQuizMasterInfo tr:eq(1) td:eq(2)").text():$("#quizMasterUserInfo tr:eq(1) td:eq(3)").text();var s=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],i=JSON.parse(quizMasterInfo.schedulingTimes),o=parseInt(i[0]),a=parseInt(i[1])<o?parseInt(i[1])+24:parseInt(i[1]),n=s.slice(o,a),r=get12HourTimeString(o)+" and "+get12HourTimeString(a),u=moment().get("hour");if(moment().diff(moment(userInfo.lockStart))<864e5){var d=getRemainingAccountLockedString();displayMessage("warning","Your account is locked","You can't start scheduling quizzes for "+d)}else-1==n.indexOf(u)?displayMessage("warning","You can't schedule a quiz","Quizzes can only be scheduled between "+r):""===$("#myAccountProfilePancardView").text()?displayMessage("warning","You can't schedule a quiz","Please update your PAN card under my profile section to start scheduling quiz"):quizMasterInfo.quizzesScheduledToday>=2?displayMessage("warning","You can't schedule a quiz","You have already scheduled 2 quiz for the day. Please try next day again"):("Unlimited"===e||e>0)&&quizMasterInfo.approvedQuestionCount>=10?"none"==$("#quizMasterScheduleQuiz").css("display")?($("#quizMasterQuestionSubmission").hide(),$("#quizMasterScheduleQuiz").show(),$("#quizMasterUserInfo").hide(),$("#quizMasterQuizMasterInfo").hide()):$("#quizMasterScheduleQuiz").hide():quizMasterInfo.approvedQuestionCount<10?displayMessage("warning","You can't schedule a quiz","You need to have 10 or more approved question before you can schedule a quiz"):t?displayMessage("warning","You can't schedule a quiz","You need to purchase more quizzes or click 'Activate as User' above to change to your user quiz scheduling account"):displayMessage("warning","You can't schedule a quiz","You need to play more paid quizzes or click 'Activate as Quiz Master' above to change to your quizmaster quiz scheduling account if you have purchased some quizzes")}function submitQuestions(){for(var e=[],t=0;10>t;t+=1){var s,i=$("#question"+t+" td:eq(0)").text(),o=$("#question"+t+" td:eq(1)").text(),a=$("#question"+t+" td:eq(2)").text(),n=$("#question"+t+" td:eq(3)").text(),r=$("#question"+t+" td:eq(4)").text(),u=$("#question"+t+" td:eq(5) select").val();s=""!==i&&""!==o&&""!==a&&""!==n&&""!==r&&""!==u?!0:!1,s&&(e.push(JSON.stringify([i,[o,a,n,r],u,sessionStorage.username])),$("#question"+t+" td:eq(0)").text(""),$("#question"+t+" td:eq(1)").text(""),$("#question"+t+" td:eq(2)").text(""),$("#question"+t+" td:eq(3)").text(""),$("#question"+t+" td:eq(4)").text(""),$("#question"+t+" td:eq(5) select").val(""))}$.post("./php/pendingquestions/addquestions.php",{username:sessionStorage.username,questions:JSON.stringify(e)},function(e){"success"==e?displayMessage("success","","Your question are submitted successfully. Once you have 10 approved questions, you can schedule a quiz."):displayMessage("error","","Error uploading questions for approval. Please use the contact form to inform the web admin of this problem.")}).fail(function(){})}function selectTimeSlot(e){$(".selectedTimeSlot").removeClass("selectedTimeSlot"),$(e).addClass("selectedTimeSlot")}function disableTimeSlots(){$(".selectedTimeSlot").removeClass("selectedTimeSlot"),$(".usedTimeSlot").removeClass("usedTimeSlot").on("onclick","selectTimeSlot(this)");var e=$("#quizMasterQuizDate").data("DateTimePicker").date().format("YYYY-MM-DD");usedTimeSlots.forEach(function(t){var s=moment(t.startTime).local();s.format("YYYY-MM-DD")===e&&$(".ts"+s.format("HH")+s.format("mm")).addClass("usedTimeSlot").prop("onclick","")})}function scheduleQuiz(){var e=areScheduleQuizInputsValid();if(e[0]){var t=$("#quizMasterQuizDate").data("DateTimePicker").date(),s=$(".selectedTimeSlot")[0].className;t.set({hour:parseInt(s.substr(2,2)),minute:parseInt(s.substr(4,2))});var i=t.utc().toISOString();$.post("./php/quizzes/scheduleuserquiz.php",{username:sessionStorage.username,name:$("#quizMasterQuizName").val(),minUsers:$("#quizMasterQuizMinUsers").val(),fee:$("#quizMasterQuizFee").val(),startTime:i,quizMaster:sessionStorage.quizMaster},function(e){"success"==e.substr(0,7)?(displayMessage("success","","Your quiz has been scheduled successfully"),location.href="quizinfo.php?editable=true&id="+e.substr(7)):displayMessage("error","","Error scheduling the quiz. Please use the contact form to inform the web admin of this problem.")}).fail(function(){})}else displayMessage("warning","",e[1])}function areScheduleQuizInputsValid(){return""===$("#quizMasterQuizName").val()?[!1,"You need to enter a name for the quiz"]:$("#quizMasterQuizFee").val()<50?[!1,"The registration fee must be at least 50"]:""===$("#quizMasterQuizMinUsers").val()?[!1,"You need to enter the minimum number of registered users required"]:0===$(".selectedTimeSlot").length?[!1,"You need to select a start time for your quiz"]:[!0,""]}function getRemainingAccountLockedString(){var e=6e4,t=60*e,s=moment().diff(moment(userInfo.lockStart));if(s>t){var i=Math.floor(s/t),o=Math.floor((s-t*i)/e);return i+" hours and "+o+" minutes."}if(s>e){var o=Math.floor(s/e);return o+" minutes."}return"less than a minute."}var currentPasswordCorrect=!1,isMobileNumberCorrect=!1,isPancardCorrect=!1,checkMobileTimer,checkPancardTimer,rzp1,conversionRate,userInfo=[],quizResults=[],withdrawals=[],purchaseHistory=[],taxations=[],quizMasterInfo=[],usedTimeSlots=[],rejectedQuestions=[],options={key:"rzp_test_DMtkjnzZPVHfJI",amount:"100",name:"Quizetos.com",description:"Real Quizetos",handler:function(e){$.post("./php/charge.php",{razorpay_payment_id:e.razorpay_payment_id,paymentAmount:options.amount,userID:sessionStorage.userID,username:sessionStorage.username},function(e){"success"===e[1]?(updatePoints(),displayMessage("info","Purchase Successful",options.amount/100+" Real Quizetos have been added to your account.")):"sqlfail"===e[1]?displayMessage("error","Error","Err or adding points to your account. Please contact the web admin to inform them of this error."):"sqlfail"===e[1]?displayMessage("error","Error","Err or capturing payment. Please contact the web admin to inform them of this error."):displayMessage("error","Error","Err or connecting to database. Please contact the web admin to inform them of this error.");
},"json").fail(function(){})},notes:{userID:"-1",username:"test"},theme:{color:"#F37254"}},tablePages={quizzes:0,purchase:0,withdrawals:0,taxation:0};window.onload=function(){global(),$("li.active").removeClass("active"),$("#myAccountMenuItem").addClass("active"),"true"!==sessionStorage.loggedIn?displayMessage("warning","You must be logged in to see this.","You need to either login above or signup for an account on the home page."):($("#showIfLoggedIn").show(),"true"===sessionStorage.buypoints?(showDeposit(),sessionStorage.buypoints="false"):"true"===sessionStorage.showQuizMaster&&(showQuizMaster(),sessionStorage.showQuizMaster="false"),$("#currentPassword").on({blur:function(){$.post("./php/users/checkpassword.php",{username:sessionStorage.username,currentPassword:$("#currentPassword").val()},function(e){"incorrect"===e?($("#currentPassword").css("border",red),$("<span class='message'>The password you entered is incorrect</span>").insertAfter("#currentPassword"),setTimeout(function(){$(".message").remove()},2e3),currentPasswordCorrect=!1):"correct"===e?($("#currentPassword").css("border",green),currentPasswordCorrect=!0):(displayMessage("error","Error","Error checking current password. Please try again later."),currentPasswordCorrect=!1)}).fail(function(){currentPasswordCorrect=!1})}}),$("#confirmPassword").on({blur:areSamePassword}),$("#newPassword").on({blur:areSamePassword}),$("#numQuizetos").on({input:function(){$("#costQuizetos").text($("#numQuizetos").val())}}),$("#numFreeQuizetos").on({input:function(){$("#numRealQuizetos").text(Math.floor($("#numFreeQuizetos").val()/conversionRate))}}),$("#numRealRedeemQuizetos").on({input:function(){$("#cashAmount").text("₹"+$("#numRealRedeemQuizetos").val())}}),$("#withdrawChequePhone").intlTelInput({initialCountry:"in",preferredCountries:"in",utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/8.4.9/js/utils.js"}),$("#withdrawBankTransferPhone").intlTelInput({initialCountry:"in",preferredCountries:"in",utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/8.4.9/js/utils.js"}),$("#withdrawChequePhone").on({input:function(){checkMobileTimer=setTimeout(checkMobileCheque,1e3)},countrychange:function(){""!==$(this).val()&&checkMobileCheque()}}),$("#withdrawBankTransferPhone").on({input:function(){checkMobileTimer=setTimeout(checkMobileBankTransfer,1e3)},countrychange:function(){""!==$(this).val()&&checkMobileBankTransfer()}}),$("#withdrawChequePancard").on({input:function(){checkPancardTimer=setTimeout(checkPancardCheque,1e3)}}),$("#withdrawBankTransferPancard").on({input:function(){checkPancardTimer=setTimeout(checkPancardBankTransfer,1e3)}}),$.post("./php/conversionrate/getconversionrate.php",{},function(e){"success"===e[0]&&(conversionRate=parseInt(e[1]),$("#conversionRateText").text(conversionRate),$("#myAccountConversionButton").prop("disabled",!1))},"json").fail(function(){}),$.get("./php/quizzes/getstarttimefromalluserscheduledquizzes.php",{},function(e){"fail"===e.substr(0,4)?displayMessage("error","","Error getting the used timeslots. Please use the contact form to inform the web admin of this problem."):usedTimeSlots=JSON.parse(e)}).fail(function(){}),$.post("./php/users/getmyaccountinfo.php",{username:sessionStorage.username},function(e){"success"===e[0]?(userInfo=e[1][0][0],e[1][1].length>0&&(quizResults=e[1][1]),e[1][2].length>0&&(withdrawals=e[1][2]),e[1][3].length>0&&(purchaseHistory=e[1][3]),e[1][4].length>0&&(taxations=e[1][4]),e[1][5].length>0&&(quizMasterInfo=e[1][5][0]),e[1][6].length>0&&(rejectedQuestions=e[1][6]),populateProfile(),populateQuizzes(),populateWithdrawals(),populatePurchases(),populateTaxations(),populateQuizMaster()):displayMessage("error","Error","Error getting account info")},"json").fail(function(){}))};
