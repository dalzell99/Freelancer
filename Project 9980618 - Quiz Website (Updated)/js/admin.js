function displayMessage(e,t){toastr[e](t)}function hideAllContainers(){$("#passwordContainer").hide(),$("#userContainer").hide(),$("#quizContainer").hide(),$("#archivedQuizzesContainer").hide(),$("#questionsContainer").hide(),$("#testimonialContainer").hide(),$("#promotionContainer").hide(),$("#withdrawalContainer").hide(),$("#distributionContainer").hide(),$("#taxationContainer").hide(),$("#quizMasterContainer").hide(),$("#pendingQuestionContainer").hide()}function setActivePage(e){$(".active").removeClass("active"),$("."+e).addClass("active"),sessionStorage.page=e}function pad(e,t){for(e=""+e;e.length<t;)e="0"+e;return e}function get12HourTimeString(e){return e>12?e-12+"pm":(0===e?12:e)+"am"}function isInt(e){return!isNaN(e)&&parseInt(Number(e))==e&&!isNaN(parseInt(e,10))}function checkPassword(){$.post("./php/admin/checkpassword.php",{username:$("#usernameInput").val(),password:$("#passwordInput").val()},function(e){if("correct"==e)switch(sessionStorage.loggedIn="true",sessionStorage.page){case"users":users();break;case"quizzes":quizzes();break;case"testimonials":testimonials();break;case"promotions":promotions();break;case"questions":questions();break;case"withdrawal":withdrawal();break;case"distribution":distribution();break;case"taxation":taxation();break;default:users()}else"incorrect"==e?($("#password").val(""),displayMessage("info","Incorrect password or username")):displayMessage("error","Error","Error: "+e)}).fail(function(){})}function populateTables(){populateUsers(),populateQuizzes(),populateArchivedQuizzes(),populateQuestions(),populateTestimonials(),populatePromotions(),populateWithdrawal(),populateDistribution(),populateTaxation(),populateQuizMaster(),populatePendingQuestion()}function quizzes(){"true"==sessionStorage.loggedIn&&(hideAllContainers(),setActivePage("quizzes"),$("#quizContainer").show())}function populateQuizzes(){$.post("./php/quizzes/getallquizzes.php",{},function(e){if("success"==e[0]){quizzesArray=e[1];for(var t="",s=0;quizzesArray.length>20&&s<quizzesArray.length/20;s+=1)t+="<button class='paginationButton"+s+"' onclick='changeQuizPage("+s+")'>"+(s+1)+"</button>";$("#createQuizPagination").empty().append(t),$("#createQuizPagination .paginationButton"+tablePages.quizzes).addClass("active");var a="";a+="<thead>",a+="    <tr>",a+="        <th>Quiz ID</th>",a+="        <th>Name</th>",a+="        <th>Type</th>",a+="        <th>Questions</th>",a+="        <th>Points Rewards</th>",a+="        <th>Points Cost</th>",a+="        <th>Start Time</th>",a+="        <th>End Time</th>",a+="        <th>Rules</th>",a+="        <th>Min Num Players</th>",a+="        <th></th>",a+="        <th></th>",a+="        <th></th>",a+="        <th></th>",a+="    </tr>",a+="</thead>",a+="<tbody>";for(var i=20*tablePages.quizzes;null!==quizzesArray&&i<quizzesArray.length&&i<20*(tablePages.quizzes+1);i+=1){for(var r="",o=JSON.parse(quizzesArray[i].questions),n="",u=JSON.parse(quizzesArray[i].pointsRewards),l="",d=JSON.parse(quizzesArray[i].rules),c=0;c<o.length;c+=1){var h=o[c][1];r+="Question: "+o[c][0]+"<br>Answers: "+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+"<br>Answer: "+h[parseInt(o[c][2])]+"<br>-------------<br>"}if("paid"==quizzesArray[i].type)for(var p=0;p<u.length;p+=1)n+=p+1+place[p>3?3:p]+") "+u[p]+"<br>";else n="5 quizeto = 100%<br />3 quizeto = 95-99%<br />1 quizeto = 90-94%";for(var m=0;m<d.length;m+=1)l+=m+1+") "+d[m]+"<br>";var f=moment(quizzesArray[i].startTime).format("ddd Do MMM YYYY h:mm a"),g=moment(quizzesArray[i].endTime).format("ddd Do MMM YYYY h:mm a");a+="<tr>",a+="    <td>"+quizzesArray[i].quizID+"</td>",a+="    <td>"+quizzesArray[i].category+"</td>",a+="    <td>"+quizzesArray[i].type+"</td>",a+='    <td class="collapsable"><div>'+r+"</div></td>",a+="    <td>"+n+"</td>",a+="    <td>"+quizzesArray[i].pointsCost+"</td>",a+="    <td>"+f+"</td>",a+="    <td>"+g+"</td>",a+='    <td class="collapsable"><div>'+l+"</div></td>",a+="    <td>"+quizzesArray[i].minPlayers+"</td>",a+='    <td><button class="btn btn-default" onclick="editQuiz('+quizzesArray[i].quizID+')">Edit</button></td>',a+='    <td><button class="btn btn-default" onclick="copyQuiz('+quizzesArray[i].quizID+')">Copy</button></td>',a+='    <td><button class="btn btn-default" onclick="deleteQuiz('+quizzesArray[i].quizID+')">Delete</button></td>',a+='    <td><button class="btn btn-default" onclick="addPromotionForQuiz('+quizzesArray[i].quizID+", '"+quizzesArray[i].category+"')\">Add Promotion</button></td>",a+="</tr>"}a+="</tbody>",$("#quizTable").empty().append(a);var z=document.getElementById("quizTable");sorttable.makeSortable(z),$("#createQuizType").on({change:function(){"paid"==$(this).val()?$("#rewardContainer").show():$("#rewardContainer").hide()}}),$(".collapsable").on({click:function(){$(this).children("div").toggle()}}),$(".collapsable > div").hide();var v="";v+="<div id='quizMasterQuizDate'></div>",v+="<table id='quizMasterQuizStartTimeTable'>";for(var b=0;24>b;b+=1){v+="<tr>";for(var w=0;6>w;w+=1)v+="<td class='ts"+pad(b,2)+pad(10*w+5,2)+"' onclick='selectTimeSlot(this)'>"+(b>12?b-12:0===b?12:b)+":"+pad(10*w+5,2)+(b>11?"pm":"am")+"</td>";v+="</tr>"}v+="</table>",$("#createQuizTimeSlot").empty().append(v),startTimePicker=$("#quizMasterQuizDate").datetimepicker({format:"dd/MM/YYYY",inline:!0}),$("#quizMasterQuizDate").on("dp.change",function(){doDisableTimeSlots?disableTimeSlots():doDisableTimeSlots=!0}),disableTimeSlots()}else displayMessage("error","Error","Error: "+e[1])},"json").fail(function(){}),populateQuestionCategories()}function populateQuestionCategories(){$.post("./php/questions/getcategories.php",{},function(e){if("success"==e[0]){for(var t=e[1],s="<option value=''></option>",a=0;a<t.length;a+=1)s+="<option value='"+t[a].category+"'>"+t[a].category+"</option>";$("#createQuizQuestionsRandomCategory").empty().append(s)}else displayMessage("error","Error","Error get question categories")},"json").fail(function(){})}function changeQuizPage(e){tablePages.quizzes=e,populateQuizzes()}function showCreateQuiz(){$("#createQuizContainer").slideToggle(),$("#createQuizUpdateButton").hide(),$("#createQuizUploadButton").show(),$("#createQuizQuestionsRandom").hide(),$("#createQuizQuestionsManual").show()}function showEditQuiz(){$("#createQuizContainer").slideDown(),$("#createQuizUpdateButton").show(),$("#createQuizUploadButton").hide(),$("#createQuizQuestionsRandom").hide(),$("#createQuizQuestionsManual").show()}function showCreateRandomQuiz(){$("#createQuizContainer").slideToggle(),$("#createQuizUpdateButton").hide(),$("#createQuizUploadButton").show(),$("#createQuizQuestionsRandom").show(),$("#createQuizQuestionsManual").hide()}function addNewQuestion(){var e=[$("#createQuizAnswer1Input").val(),$("#createQuizAnswer2Input").val(),$("#createQuizAnswer3Input").val(),$("#createQuizAnswer4Input").val()];questionsArray.push([$("#createQuizQuestionInput").val(),e]),refreshQuestionTable(),$("#createQuizQuestionInput").val(""),$("#createQuizAnswer1Input").val(""),$("#createQuizAnswer1Input").val(""),$("#createQuizAnswer1Input").val(""),$("#createQuizAnswer1Input").val("")}function addAnswer(e,t){questionsArray[e][2]=t,$(".questions."+e+" .selectedAnswer").removeClass("selectedAnswer"),$(".questions."+e+" .answer."+t).addClass("selectedAnswer")}function removeQuestion(e){var t=questionsArray[e][0],s=JSON.stringify(questionsArray[e][1]),a=questionsArray[e][2]+1;$.post("./php/questions/createnewquestion.php",{question:t,answers:s,correctAnswer:a,category:"Miscellaneous"},function(e){"success"==e||displayMessage("error","Error","Error readding question to database")}).fail(function(){}),questionsArray.splice(e,1),refreshQuestionTable()}function refreshQuestionTable(){var e="";e+="<tr>",e+="    <th>Question</th>",e+="    <th>Answer1</th>",e+="    <th>Answer2</th>",e+="    <th>Answer3</th>",e+="    <th>Answer4</th>",e+="    <th></th>",e+="</tr>";for(var t=0;t<questionsArray.length;t+=1){var s=questionsArray[t][1];e+='<tr class="questions '+t+'">',e+='    <td class="question '+t+'"contenteditable="true">'+questionsArray[t][0]+"</td>",e+='    <td class="answer 0" contenteditable="true" onclick="addAnswer('+t+', 0)">'+s[0]+"</td>",e+='    <td class="answer 1" contenteditable="true" onclick="addAnswer('+t+', 1)">'+s[1]+"</td>",e+='    <td class="answer 2" contenteditable="true" onclick="addAnswer('+t+', 2)">'+s[2]+"</td>",e+='    <td class="answer 3" contenteditable="true" onclick="addAnswer('+t+', 3)">'+s[3]+"</td>",e+='    <td><button class="btn btn-default" onclick="removeQuestion('+t+')">Delete</button></td>',e+="</tr>"}$("#createQuizQuestions").empty().append(e);for(var a=0;a<questionsArray.length;a+=1)$(".questions."+a+" .answer."+parseInt(questionsArray[a][2])).addClass("selectedAnswer");$(".questions > [contenteditable=true]").on({blur:function(){var e=this.classList[0],t=parseInt(this.parentElement.classList[1]),s=parseInt(this.classList[1]);"question"==e?questionsArray[t][0]=$(this).text():questionsArray[t][1][s]=$(this).text()}})}function addNewRule(){rules.push($("#createQuizRuleInput").val()),refreshRuleTable(),$("#createQuizRuleInput").val("")}function deleteRule(e){rules.splice(e,1),refreshRuleTable()}function refreshRuleTable(){var e="";e+="<tr>",e+="    <th>Rules</th>",e+="    <th></th>",e+="</tr>";for(var t=0;t<rules.length;t+=1)e+='<tr class="rules '+t+'">',e+='    <td contenteditable="true">'+rules[t]+"</td>",e+='    <td><button class="btn btn-default" onclick="deleteRule('+t+')">Delete</button></td>',e+="</tr>";$("#createQuizRules").empty().append(e),$(".rules > [contenteditable=true]").on({blur:function(){var e=parseInt(this.parentElement.classList[1]);rules[e]=$(this).text()}})}function uploadQuiz(){var e=areInputsValidQuizzes();if(e[0]){var t=$("#quizMasterQuizDate").data("DateTimePicker").date(),s=$(".selectedTimeSlot")[0].className;t.set({hour:parseInt(s.substr(2,2)),minute:parseInt(s.substr(4,2))});var a=t.utc().toISOString(),i=t.add(2,"minutes").utc().toISOString();"free"==$("#createQuizType").val()?(rules.push("User need free quizeto balance to register in this quiz"),rules.push("User can unregister from the quiz until 10 minutes before the start of the quiz"),rules.push("No minimum participant required to start this quiz"),rules.push("Prize pool contains bonus quzeto which can be redemed after conversting to real quizeto"),rules.push("Winning criteria: 100% correct answer = 5 Bonus Quizeto, 95-99% correct answer = 3 Bonus Quizeto, 90-94% correct answer = 1 Bonus Quizeto")):(rules.push("User need real quizeto balance to register in this quiz"),rules.push("Prize pool contains redeemable real quizeto"),rules.push("Winners will be decided based on maximum number of correct answer given in minimum time"),rules.push("User can unregister from the quiz until 10 minutes before the start of the quiz"),rules.push("Incase of less number of participant, quiz will be automatically cancelled"),rules.push("Quizeto will be refunded to respective user account if quiz gets cancelled")),$.post("./php/quizzes/createnewquiz.php",{username:"admin",type:$("#createQuizType").val(),questions:JSON.stringify(questionsArray),category:$("#createQuizCategory").val(),pointsCost:$("#createQuizPointsCost").val(),startTime:a,endTime:i,rules:JSON.stringify(rules),minPlayers:$("#createQuizMinPlayers").val()},function(e){"success"==e?(sessionStorage.copiedQuiz=!1,$("#createQuizContainer").slideUp(),populateQuizzes(),displayMessage("info","Quiz has been created.")):displayMessage("error","Error","Error: "+e)}).fail(function(){})}else displayMessage("info",e[1])}function editQuiz(e){for(var t=0;t<quizzesArray.length;t+=1)if(quizzesArray[t].quizID==e){var s=quizzesArray[t];$("#createQuizType").val(s.type),$("#createQuizCategory").val(s.category),$("#createQuizPointsCost").val(s.pointsCost),$("#createQuizMinPlayers").val(s.minPlayers),doDisableTimeSlots=!1;var a=moment(s.startTime);startTimePicker.data("DateTimePicker").date(a),selectTimeSlot($(".ts"+pad(a.get("hour"))+pad(a.get("minute")))[0]),$(".ts"+pad(a.get("hour"))+pad(a.get("minute"))).removeClass("usedTimeSlot"),rules=JSON.parse(s.rules),questionsArray=JSON.parse(s.questions),refreshQuestionTable(),refreshRuleTable(),updateQuizID=e}showEditQuiz()}function copyQuiz(e){for(var t=0;t<quizzesArray.length;t+=1)if(quizzesArray[t].quizID==e){var s=quizzesArray[t];$("#createQuizType").val(s.type),$("#createQuizCategory").val(s.category),$("#createQuizPointsCost").val(s.pointsCost),$("#createQuizMinPlayers").val(s.minPlayers),doDisableTimeSlots=!1;var a=moment(s.startTime);startTimePicker.data("DateTimePicker").date(a),selectTimeSlot($(".ts"+pad(a.get("hour"))+pad(a.get("minute")))[0]),$(".ts"+pad(a.get("hour"))+pad(a.get("minute"))).removeClass("usedTimeSlot"),rules=[],questionsArray=JSON.parse(s.questions),refreshQuestionTable(),refreshRuleTable(),updateQuizID=e,sessionStorage.copiedQuiz="true"}showCreateQuiz()}function deleteQuiz(e){$.post("./php/quizzes/deletequiz.php",{quizID:e},function(e){"success"==e?(populateQuizzes(),displayMessage("info","Quiz has been deleted.")):displayMessage("error","Error","Error: "+e)}).fail(function(){})}function updateQuiz(){var e=areInputsValidQuizzes();if(e[0]){var t=$("#quizMasterQuizDate").data("DateTimePicker").date(),s=$(".selectedTimeSlot")[0].className;t.set({hour:parseInt(s.substr(2,2)),minute:parseInt(s.substr(4,2))});var a=t.utc().toISOString(),i=t.add(2,"minutes").utc().toISOString();$.post("./php/quizzes/updatequiz.php",{quizID:updateQuizID,type:$("#createQuizType").val(),questions:JSON.stringify(questionsArray),category:$("#createQuizCategory").val(),pointsCost:$("#createQuizPointsCost").val(),startTime:a,endTime:i,rules:JSON.stringify(rules),minPlayers:$("#createQuizMinPlayers").val()},function(e){"success"==e?(populateQuizzes(),$("#createQuizContainer").slideUp(),displayMessage("info","Quiz has been updated.")):displayMessage("error","Error","Error: "+e)}).fail(function(){})}else displayMessage("info",e[1])}function areInputsValidQuizzes(){if(""===$("#createQuizCategory").val())return[!1,"Please enter a quiz name"];if(""===$("#createQuizPointsCost").val())return[!1,"Please enter a registration fee"];for(var e=0;e<questionsArray.length;e+=1)if(void 0===questionsArray[e][2])return[!1,"Some questions don't have answers"];return""===$("#createQuizMinPlayers").val()?[!1,"Please enter the minimum number of users needed"]:0===$(".selectedTimeSlot").length?[!1,"You need to select a start time for your quiz"]:[!0]}function addPromotionForQuiz(e,t){$("#createPromotionQuizID").val(e),$("#createPromotionQuizName").val(t),promotions(),$("#createPromotionContainer").show()}function addRandomQuestions(){""!==$("#createQuizQuestionsRandomNum").val()&&""!==$("#createQuizQuestionsRandomCategory").val()?$.post("./php/questions/getrandomquestions.php",{numQuestions:$("#createQuizQuestionsRandomNum").val(),category:$("#createQuizQuestionsRandomCategory").val()},function(e){if("success"==e[0]){var t=[];e[1].forEach(function(e){null!==e&&t.push([e.question,JSON.parse(e.answers),parseInt(e.correctAnswer),e.creator])}),t.length<$("#createQuizQuestionsRandomNum").val()&&displayMessage("info","There are only "+t.length+" questions with in the "+$("#createQuizQuestionsRandomCategory").val()+" category"),questionsArray=t,refreshQuestionTable()}else displayMessage("error","Error","Error: "+e[1])},"json").fail(function(){}):displayMessage("info","Make sure you enter the number of questions and category then try again")}function selectTimeSlot(e){$(".selectedTimeSlot").removeClass("selectedTimeSlot"),$(e).addClass("selectedTimeSlot")}function disableTimeSlots(){$.get("./php/quizzes/getstarttimefromalladminscheduledquizzes.php",{},function(e){if("fail"===e.substr(0,4))displayMessage("error","","Error getting the used timeslots. Please use the contact form to inform the web admin of this problem.");else{var t=JSON.parse(e);$(".selectedTimeSlot").removeClass("selectedTimeSlot"),$(".usedTimeSlot").removeClass("usedTimeSlot").on("onclick","selectTimeSlot(this)");var s=$("#quizMasterQuizDate").data("DateTimePicker").date().format("YYYY-MM-DD");t.forEach(function(e){var t=moment(e.startTime).local();t.format("YYYY-MM-DD")===s&&$(".ts"+t.format("HH")+t.format("mm")).addClass("usedTimeSlot").prop("onclick","")})}}).fail(function(){})}function scheduleQuiz(){var e=areScheduleQuizInputsValid();if(e[0]){var t=$("#quizMasterQuizDate").data("DateTimePicker").date(),s=$(".selectedTimeSlot")[0].className;t.set({hour:parseInt(s.substr(2,2)),minute:parseInt(s.substr(4,2))});var a=t.utc().toISOString();$.post("./php/quizzes/scheduleuserquiz.php",{username:sessionStorage.username,name:$("#quizMasterQuizName").val(),minUsers:$("#quizMasterQuizMinUsers").val(),fee:$("#quizMasterQuizFee").val(),startTime:a,quizMaster:sessionStorage.quizMaster},function(e){"success"==e.substr(0,7)?(displayMessage("success","","Your quiz has been scheduled successfully"),location.href="quizinfo.php?editable=true&id="+e.substr(7)):displayMessage("error","","Error scheduling the quiz. Please use the contact form to inform the web admin of this problem.")}).fail(function(){})}else displayMessage("warning","",e[1])}function areScheduleQuizInputsValid(){return""===$("#quizMasterQuizName").val()?[!1,"You need to enter a name for the quiz"]:$("#quizMasterQuizFee").val()<50?[!1,"The registration fee must be at least 50"]:""===$("#quizMasterQuizMinUsers").val()?[!1,"You need to enter the minimum number of registered users required"]:[!0,""]}function archivedQuizzes(){"true"==sessionStorage.loggedIn&&(hideAllContainers(),setActivePage("archivedQuizzes"),$("#archivedQuizzesContainer").show())}function populateArchivedQuizzes(){$.post("./php/quizzes/getallarchivedquizzes.php",{},function(e){if("success"==e[0]){for(var t=e[1],s="",a=0;t.length>20&&a<t.length/20;a+=1)s+="<button class='paginationButton"+a+"' onclick='changeArchivedQuizPage("+a+")'>"+(a+1)+"</button>";$("#createArchivedQuizzesPagination").empty().append(s),$("#createArchivedQuizzesPagination .paginationButton"+tablePages.archivedQuizzes).addClass("active");var i="";i+="<thead>",i+="    <tr>",i+="        <th>Name</th>",i+="        <th>Date</th>",i+="        <th>Type</th>",i+="        <th>Registration Fee</th>",i+="        <th>Total Players</th>",i+="        <th>Prize Pool</th>",i+="        <th>1st Place User</th>",i+="        <th>2nd Place User</th>",i+="        <th>3rd Place User</th>",i+="        <th>1st Place Prize</th>",i+="        <th>2nd Place Prize</th>",i+="        <th>3rd Place Prize</th>",i+="        <th>1st Place Tax</th>",i+="        <th>2nd Place Tax</th>",i+="        <th>3rd Place Tax</th>",i+="        <th>Platform Fee</th>",i+="    </tr>",i+="</thead>",i+="<tbody>";for(var r=20*tablePages.archivedQuizzes;null!==t&&r<t.length&&r<20*(tablePages.archivedQuizzes+1);r+=1){var o,n=t[r].type,u=moment(t[r].startDate).format("ddd Do MMM YYYY"),l=t[r].winners[0],d=t[r].winners[1],c=t[r].winners[2],h=JSON.parse(t[r].pointsRewards),p=h[0],m=h[1],f=h[2],g=p+m+f,z=t[r].tax[0],v=t[r].tax[1],b=t[r].tax[2],w=JSON.parse(t[r].userRegistered).length,y=t[r].pointsCost;o="n"===t[r].cancelled&&"paid"===n?w*y-g:"free"===n?0:"Cancelled",i+="<tr>",i+="    <td>"+t[r].category+"</td>",i+="    <td>"+u+"</td>",i+="    <td>"+n+"</td>",i+="    <td>"+y+"</td>",i+="    <td>"+w+"</td>",i+="    <td>"+g+"</td>",i+="    <td>"+l+"</td>",i+="    <td>"+d+"</td>",i+="    <td>"+c+"</td>",i+="    <td>"+p+"</td>",i+="    <td>"+m+"</td>",i+="    <td>"+f+"</td>",i+="    <td>"+z+"</td>",i+="    <td>"+v+"</td>",i+="    <td>"+b+"</td>",i+="    <td>"+o+"</td>",i+="</tr>"}i+="</tbody>",$("#archivedQuizzesTable").empty().append(i);var q=document.getElementById("archivedQuizzesTable");sorttable.makeSortable(q),$("#archivedQuizzesTotalPlatformFee").text(t.reduce(function(e,t){var s,a=t.type,i=JSON.parse(t.pointsRewards),r=i[0],o=i[1],n=i[2],u=r+o+n,l=JSON.parse(t.userRegistered).length,d=t.pointsCost;return s="n"===t.cancelled&&"paid"===a?l*d-u:0,e+s},0))}else displayMessage("error","Error","Error: "+e[1])},"json").fail(function(){})}function changeArchivedQuizPage(e){tablePages.archivedQuizzes=e,populateArchivedQuizzes()}function questions(){"true"==sessionStorage.loggedIn&&(hideAllContainers(),setActivePage("questions"),$("#questionsContainer").show())}function populateQuestions(){$.post("./php/questions/getallquestions.php",{},function(e){if("success"==e[0]){allQuestionsArray=e[1];var t=[];"true"===sessionStorage.adminQuestions||void 0===sessionStorage.adminQuestions?allQuestionsArray.forEach(function(e){"admin"===e.creator&&t.push(e)}):allQuestionsArray.forEach(function(e){"admin"!==e.creator&&t.push(e)});for(var s="",a=0;t.length>20&&a<t.length/20;a+=1)s+="<button class='paginationButton"+a+"' onclick='changeQuestionPage("+a+")'>"+(a+1)+"</button>";$("#createQuestionPagination").empty().append(s),$("#createQuestionPagination .paginationButton"+tablePages.questions).addClass("active");var i="";i+="<thead>",i+="    <tr>",i+="        <th>Question ID</th>",i+="        <th>Questions</th>",i+="        <th>Answers</th>",i+="        <th>Category</th>",i+="        <th></th>",i+="        <th></th>",i+="    </tr>",i+="</thead>",i+="<tbody>";for(var r=20*tablePages.questions;null!==t&&r<t.length&&r<20*(tablePages.questions+1);r+=1){var o=JSON.parse(t[r].answers),n="Answers: "+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+"<br>Correct Answer: "+o[parseInt(t[r].correctAnswer)];i+="<tr>",i+="    <td>"+t[r].questionID+"</td>",i+="    <td>"+t[r].question+"</td>",i+="    <td>"+n+"</td>",i+="    <td>"+t[r].category+"</td>",i+='    <td><button class="btn btn-default" onclick="editQuestion('+t[r].questionID+')">Edit</button></td>',i+='    <td><button class="btn btn-default" onclick="deleteQuestion('+t[r].questionID+')">Delete</button></td>',i+="</tr>"}i+="</tbody>",$("#questionsTable").empty().append(i);var u=document.getElementById("questionsTable");sorttable.makeSortable(u),$("input[type='radio']").on({click:function(){$("input[type='radio']").prop("checked",!1),$(this).prop("checked",!0),selectedQAnswer=this.classList[0].substr(5)}})}else displayMessage("error","Error","Error")},"json").fail(function(){}),$.post("./php/questions/getcategories.php",{},function(e){if("success"==e[0]){for(var t=e[1],s="<option value=''></option>",a=0;a<t.length;a+=1)s+="<option value='"+t[a].category+"'>"+t[a].category+"</option>";$("#createQuestionCategorySelect").empty().append(s)}else displayMessage("error","Error","Error")},"json").fail(function(){})}function changeQuestionPage(e){tablePages.questions=e,populateQuestions()}function showCreateQuestion(){$("#createQuestionContainer").slideToggle(),$("#createQuestionUploadButton").show(),$("#createQuestionUpdateButton").hide()}function showEditQuestion(){$("#createQuestionContainer").slideToggle(),$("#createQuestionUploadButton").hide(),$("#createQuestionUpdateButton").show()}function editQuestion(e){for(var t=0;t<allQuestionsArray.length;t+=1)if(allQuestionsArray[t].questionID==e){var s=allQuestionsArray[t];$("#createQuestionQuestion").val(s.question),$("#createQuestionCategory").val(s.category),JSON.parse(s.answers).forEach(function(e,t){$("#createQuestionAnswer"+(t+1)).val(e)}),$(".radio"+s.correctAnswer).prop("checked",!0),updateQuestionID=e}showEditQuestion()}function uploadQuestion(){var e=areInputsValidQuestion();if(e[0]){var t,s=JSON.stringify([$("#createQuestionAnswer1").val(),$("#createQuestionAnswer2").val(),$("#createQuestionAnswer3").val(),$("#createQuestionAnswer4").val()]);t=""!==$("#createQuestionCategory").val()?$("#createQuestionCategory").val():$("#createQuestionCategorySelect").val(),$.post("./php/questions/createnewquestion.php",{question:$("#createQuestionQuestion").val(),answers:s,correctAnswer:selectedQAnswer,category:t},function(e){"success"==e?(populateQuestions(),populateQuestionCategories(),displayMessage("info","Question has been created."),$("#createQuestionAnswer1").val(""),$("#createQuestionAnswer2").val(""),$("#createQuestionAnswer3").val(""),$("#createQuestionAnswer4").val(""),$("#createQuestionQuestion").val(""),$("#createQuestionCategory").val("")):displayMessage("error","Error","Error:")}).fail(function(){})}else displayMessage("info",e[1])}function updateQuestion(){var e=areInputsValidQuestion();if(e[0]){var t,s=JSON.stringify([$("#createQuestionAnswer1").val(),$("#createQuestionAnswer2").val(),$("#createQuestionAnswer3").val(),$("#createQuestionAnswer4").val()]);t=""!==$("#createQuestionCategory").val()?$("#createQuestionCategory").val():$("#createQuestionCategorySelect").val(),$.post("./php/questions/updatequestion.php",{questionID:updateQuestionID,question:$("#createQuestionQuestion").val(),answers:s,correctAnswer:selectedQAnswer,category:t},function(e){"success"==e?(populateQuizzes(),$("#createQuestionContainer").slideUp(),displayMessage("info","Question has been updated.")):displayMessage("error","Error","Error: ")}).fail(function(){})}else displayMessage("info",e[1])}function deleteQuestion(e){$.post("./php/questions/deletequestion.php",{questionID:e},function(e){"success"==e?(populateQuestions(),displayMessage("info","Question has been deleted.")):displayMessage("error","Error","Error")}).fail(function(){})}function areInputsValidQuestion(){return""===$("#createQuestionCategory").val()&&""===$("#createQuestionCategorySelect").val()?[!1,"Please enter a question category"]:""===$("#createQuestionQuestion").val()?[!1,"Please enter a question"]:""===$("#createQuestionAnswer1").val()?[!1,"Please enter answer 1"]:""===$("#createQuestionAnswer2").val()?[!1,"Please enter answer 2"]:""===$("#createQuestionAnswer3").val()?[!1,"Please enter answer 3"]:""===$("#createQuestionAnswer4").val()?[!1,"Please enter answer 4"]:-1==selectedQAnswer?[!1,"Please select an answer radio button"]:[!0]}function showAdminQuestions(){sessionStorage.adminQuestions="true",populateQuestions()}function showUserQuestions(){sessionStorage.adminQuestions="false",populateQuestions()}function testimonials(){"true"==sessionStorage.loggedIn&&(hideAllContainers(),setActivePage("testimonials"),$("#testimonialContainer").show())}function populateTestimonials(){$.post("./php/testimonials/getalltestimonials.php",{},function(e){if("success"==e[0]){testimonialsArray=e[1];for(var t="",s=0;testimonialsArray.length>20&&s<testimonialsArray.length/20;s+=1)t+="<button class='paginationButton"+s+"' onclick='changeTestimonialPage("+s+")'>"+(s+1)+"</button>";$("#createTestimonialPagination").empty().append(t),$("#createTestimonialPagination .paginationButton"+tablePages.testimonials).addClass("active");var a="";a+="<thead>",a+="    <tr>",a+="        <th>Testimonial ID</th>",a+="        <th>Username</th>",a+="        <th>Message</th>",a+="        <th></th>",a+="        <th></th>",a+="    </tr>",a+="</thead>",a+="<tbody>";for(var i=20*tablePages.testimonials;null!==testimonialsArray&&i<testimonialsArray.length&&i<20*(tablePages.testimonials+1);i+=1)a+="<tr>",a+="    <td>"+testimonialsArray[i].testimonialID+"</td>",a+='    <td contenteditable="true">'+testimonialsArray[i].username+"</td>",a+='    <td contenteditable="true">'+testimonialsArray[i].message+"</td>",a+='    <td><img class="testimonialImages" src="./php/testimonials/uploads/'+testimonialsArray[i].imageURL+'"></td>',a+='    <td><button onclick="deleteTestimonial('+testimonialsArray[i].testimonialID+')">Delete</button></td>',a+="</tr>";a+="</tbody>",$("#testimonialTable").empty().append(a);var r=document.getElementById("testimonialTable");sorttable.makeSortable(r),$("#testimonialTable td").on({blur:function(){$(this).text()!=sessionStorage.contentEditable&&$.post("./php/testimonials/updatetestimonial.php",{testimonialID:$(this).parent().children(":nth-child(1)").text(),username:$(this).parent().children(":nth-child(2)").text(),message:$(this).parent().children(":nth-child(3)").text()},function(e){"success"==e?displayMessage("info","Testimonial has been updated."):displayMessage("error","Error","Error: "+e)}).fail(function(){})},focus:function(){sessionStorage.contentEditable=$(this).text()}})}else displayMessage("error","Error","Error: "+e[1])},"json").fail(function(){})}function changeTestimonialPage(e){tablePages.testimonials=e,populateTestimonials()}function showCreateTestimonial(){$("#createTestimonialContainer").slideToggle()}function uploadTestimonial(){$.post("./php/testimonials/uploadtestimonial.php",{username:$("#createTestimonialUsername").val(),message:$("#createTestimonialMessage").val()},function(e){"success"==e?(populateTestimonials(),displayMessage("info","Testimonial has been uploaded.")):displayMessage("error","Error","Error: "+e)}).fail(function(){})}function deleteTestimonial(e){$.post("./php/testimonials/deletetestimonial.php",{testimonialID:e},function(e){"success"==e?(populateTestimonials(),displayMessage("info","Testimonial has been deleted.")):displayMessage("error","Error","Error: "+e)}).fail(function(){})}function users(){"true"==sessionStorage.loggedIn&&(hideAllContainers(),setActivePage("users"),$("#userContainer").show())}function populateUsers(){$.post("./php/users/getallusers.php",{},function(e){if("success"==e[0]){userArray=e[1];for(var t="",s=0;userArray.length>20&&s<userArray.length/20;s+=1)t+="<button class='paginationButton"+s+"' onclick='changeUserPage("+s+")'>"+(s+1)+"</button>";$("#createUserPagination").empty().append(t),$("#createUserPagination .paginationButton"+tablePages.users).addClass("active");var a="";a+="<thead>",a+="    <tr>",a+="        <th>Username</th>",a+="        <th>Real Quizetos</th>",a+="        <th>Bonus Quizetos</th>",a+="        <th>Free Quizetos</th>",a+="        <th>Email</th>",a+="        <th>Mobile</th>",a+="        <th>First Name</th>",a+="        <th>Last Name</th>",a+="        <th>Gender</th>",a+="        <th>DOB</th>",a+="        <th>City</th>",a+="        <th>Pincode</th>",a+="        <th>State</th>",a+="        <th>Country</th>",a+="        <th>Profile Image</th>",a+="    </tr>",a+="</thead>",a+="<tbody>";for(var i=20*tablePages.users;null!==userArray&&i<userArray.length&&i<20*(tablePages.users+1);i+=1)a+="<tr onclick=\"showUserInfo('"+userArray[i].username+"')\">",a+='    <td style="display: none">'+userArray[i].userID+"</td>",a+="    <td>"+userArray[i].username+"</td>",a+='    <td contenteditable="true">'+userArray[i].paidPointsBalance+"</td>",a+='    <td contenteditable="true">'+userArray[i].freeConvertablePointsBalance+"</td>",a+='    <td contenteditable="true">'+userArray[i].freeUnconvertablePointsBalance+"</td>",a+='    <td contenteditable="true">'+userArray[i].email+"</td>",a+='    <td contenteditable="true">'+userArray[i].mobile+"</td>",a+='    <td contenteditable="true">'+userArray[i].firstName+"</td>",a+='    <td contenteditable="true">'+userArray[i].lastName+"</td>",a+='    <td contenteditable="true">'+userArray[i].gender+"</td>",a+='    <td contenteditable="true">'+userArray[i].DOB+"</td>",a+='    <td contenteditable="true">'+userArray[i].city+"</td>",a+='    <td contenteditable="true">'+userArray[i].pincode+"</td>",a+='    <td contenteditable="true">'+userArray[i].state+"</td>",a+='    <td contenteditable="true">'+userArray[i].country+"</td>",a+='    <td><img class="userProfileImages" src="./images/users/'+(""===userArray[i].imageURL?"missing.png":userArray[i].imageURL)+'" alt="" /></td>',a+="</tr>";a+="</tbody>",$("#userTable").empty().append(a);var r=document.getElementById("userTable");sorttable.makeSortable(r),$("#userTotalRealQuizeto").text(userArray.reduce(function(e,t){return e+parseInt(t.paidPointsBalance)},0)),$("#convertRate").val(e[2].rate),$("#convertRate").on({blur:function(){isInt($(this).val())&&$.post("./php/conversionrate/change.php",{rate:$(this).val()},function(e){"success"==e?displayMessage("info","Conversion rate changed"):displayMessage("error","Error","Err or changing conversion rate. Contact the web admin to inform them of this error.")}).fail(function(){})}}),$("#userTable [contenteditable='true']").on({blur:function(){var e=$(this);e.text()!=sessionStorage.contentEditable&&$.post("./php/users/updateuser.php",{userID:e.parent().children(":nth-child(1)").text(),
paidPoints:e.parent().children(":nth-child(3)").text(),freeConvertablePoints:e.parent().children(":nth-child(4)").text(),freeUnconvertablePoints:e.parent().children(":nth-child(5)").text(),email:e.parent().children(":nth-child(6)").text(),mobile:e.parent().children(":nth-child(7)").text()},function(t){"success"==t?displayMessage("info","User info updated for "+e.parent().children(":nth-child(2)").text()):displayMessage("error","Error","Error updating user info.")}).fail(function(){})},focus:function(){sessionStorage.contentEditable=$(this).text()}})}else displayMessage("error","Error","Error: "+e[1])},"json").fail(function(){})}function changeUserPage(e){tablePages.users=e,populateUsers()}function showUserInfo(e){$.get("./php/users/getalluserinfo.php",{username:e},function(e){if("fail"!=e.substr(0,4)){e=JSON.parse(e);var t="";t+="<div id='userInfoModalQuiz'>",t+="    <div onclick='$(\"#userInfoModalQuizTable\").toggle()'>Quiz Results</div>",t+="    <table id='userInfoModalQuizTable'>",t+="        <tr>",t+="            <th>Quiz Name</th>",t+="            <th>Date</th>",t+="            <th>Type</th>",t+="            <th>Registration Fee</th>",t+="            <th>Rank</th>",t+="        </tr>",e[0].forEach(function(e){var s=moment(e.date).format("ddd Do MMM YYYY");t+="    <tr>",t+="        <td>"+e.name+"</td>",t+="        <td>"+s+"</td>",t+="        <td>"+e.type+"</td>",t+="        <td>"+e.registrationFee+"</td>",t+="        <td>"+e.userRank+"</td>",t+="    </tr>"}),t+="    </table>",t+="</div>",t+="<div id='userInfoModalConversion'>",t+="    <div onclick='$(\"#userInfoModalConversionTable\").toggle()'>Conversions</div>",t+="    <table id='userInfoModalConversionTable'>",t+="        <tr>",t+="            <th>Date</th>",t+="            <th>Bonus Quizetos</th>",t+="            <th>Real Quizetos</th>",t+="        </tr>",e[1].forEach(function(e){var s=moment(e.date).format("ddd Do MMM YYYY");t+="    <tr>",t+="        <td>"+s+"</td>",t+="        <td>"+e.bonusQuizetos+"</td>",t+="        <td>"+e.realQuizetos+"</td>",t+="    </tr>"}),t+="    </table>",t+="</div>",t+="<div id='userInfoModalPurchase'>",t+="    <div onclick='$(\"#userInfoModalPurchaseTable\").toggle()'>Purchases</div>",t+="    <table id='userInfoModalPurchaseTable'>",t+="        <tr>",t+="            <th>Date</th>",t+="            <th>Amount</th>",t+="        </tr>",e[2].forEach(function(e){var s=moment(e.datePurchased).format("ddd Do MMM YYYY");t+="    <tr>",t+="        <td>"+s+"</td>",t+="        <td>"+e.amount+"</td>",t+="    </tr>"}),t+="    </table>",t+="</div>",t+="<div id='userInfoModalRedeem'>",t+="    <div onclick='$(\"#userInfoModalRedeemTable\").toggle()'>Redemptions</div>",t+="    <table id='userInfoModalRedeemTable'>",t+="        <tr>",t+="            <th>Date</th>",t+="            <th>Amount</th>",t+="            <th>Method</th>",t+="            <th>Processed</th>",t+="        </tr>",e[3].forEach(function(e){var s=moment(e.time).format("ddd Do MMM YYYY");t+="    <tr>",t+="        <td>"+s+"</td>",t+="        <td>"+e.amount+"</td>",t+="        <td>"+e.method+"</td>",t+="        <td>"+("y"===e.done?"Yes":"No")+"</td>",t+="    </tr>"}),t+="    </table>",t+="</div>",t+="<div id='userInfoModalTaxation'>",t+="    <div onclick='$(\"#userInfoModalTaxationTable\").toggle()'>Taxation</div>",t+="    <table id='userInfoModalTaxationTable'>",t+="        <tr>",t+="            <th>Date</th>",t+="            <th>Quiz Name</th>",t+="            <th>Registration Fee</th>",t+="            <th>Quizetos Won</th>",t+="            <th>Tax Amount</th>",t+="            <th>Net Quizetos</th>",t+="        </tr>",e[4].forEach(function(e){var s=moment(e.date).format("ddd Do MMM YYYY");t+="    <tr>",t+="        <td>"+s+"</td>",t+="        <td>"+e.name+"</td>",t+="        <td>"+e.registrationFee+"</td>",t+="        <td>"+e.grossQuizetos+"</td>",t+="        <td>"+e.taxAmount+"</td>",t+="        <td>"+e.netQuizetos+"</td>",t+="    </tr>"}),t+="    </table>",t+="</div>",$("#userInfoModal .modal-body").html(t),$("#userInfoModal").modal()}else displayMessage("error","Error getting this users info")}).fail(function(){})}function promotions(){"true"==sessionStorage.loggedIn&&(hideAllContainers(),setActivePage("promotions"),$("#promotionContainer").show())}function populatePromotions(){$.post("./php/promotions/getallpromotions.php",{},function(e){if("success"==e[0]){promotionArray=e[1];for(var t="",s=0;promotionArray.length>20&&s<promotionArray.length/20;s+=1)t+="<button class='paginationButton"+s+"' onclick='changePromotionPage("+s+")'>"+(s+1)+"</button>";$("#createPromotionPagination").empty().append(t),$("#createPromotionPagination .paginationButton"+tablePages.promotions).addClass("active");var a="";a+="<thead>",a+="    <tr>",a+="        <th>Promotion ID</th>",a+="        <th>QuizID</th>",a+="        <th>Image</th>",a+="        <th></th>",a+="    </tr>",a+="</thead>",a+="<tbody>";for(var i=20*tablePages.promotions;null!==promotionArray&&i<promotionArray.length&&i<20*(tablePages.promotions+1);i+=1)a+="<tr>",a+="    <td>"+promotionArray[i].promotionID+"</td>",a+="    <td>"+promotionArray[i].quizID+"</td>",a+='    <td><img class="promotionImages" src="./php/promotions/uploads/'+promotionArray[i].imageURL+'"></td>',a+='    <td><button class="btn btn-default" onclick="deletePromotion('+promotionArray[i].promotionID+')">Delete</button></td>',a+="</tr>";a+="</tbody>",$("#promotionTable").empty().append(a);var r=document.getElementById("promotionTable");sorttable.makeSortable(r)}else displayMessage("error","Error","Error: "+e[1])},"json").fail(function(){})}function changePromotionPage(e){tablePages.promotions=e,populatePromotions()}function deletePromotion(e){$.post("./php/promotions/deletepromotion.php",{promotionID:e},function(e){"success"==e?(displayMessage("info","Promotion has been deleted"),populatePromotions()):displayMessage("error","Error","Err or deleting promotion. Try again later or contact web admin")}).fail(function(){})}function withdrawal(){"true"==sessionStorage.loggedIn&&(hideAllContainers(),setActivePage("withdrawal"),$("#withdrawalContainer").show())}function populateWithdrawal(){$.post("./php/withdrawals/getallwithdrawals.php",{},function(e){if("success"==e[0]){withdrawalArray=e[1];for(var t="",s=0;withdrawalArray.length>20&&s<withdrawalArray.length/20;s+=1)t+="<button class='paginationButton"+s+"' onclick='changeWithdrawalPage("+s+")'>"+(s+1)+"</button>";$("#createWithdrawalPagination").empty().append(t),$("#createWithdrawalPagination .paginationButton"+tablePages.withdrawals).addClass("active");var a="";a+="<thead>",a+="    <tr>",a+="        <th>Withdrawal ID</th>",a+="        <th>Username</th>",a+="        <th>Amount</th>",a+="        <th>Method</th>",a+="        <th>Phone</th>",a+="        <th>Email</th>",a+="        <th>Pancard</th>",a+="        <th>Address</th>",a+="        <th>Account Num</th>",a+="        <th>IFSC Code</th>",a+="        <th>Time Withdrawn</th>",a+="        <th></th>",a+="    </tr>",a+="</thead>",a+="<tbody>";for(var i=20*tablePages.withdrawals;null!==withdrawalArray&&i<withdrawalArray.length&&i<20*(tablePages.withdrawals+1);i+=1)a+="<tr>",a+="    <td>"+withdrawalArray[i].withdrawalID+"</td>",a+="    <td>"+withdrawalArray[i].username+"</td>",a+="    <td>"+withdrawalArray[i].amount+"</td>",a+="    <td>"+withdrawalArray[i].method+"</td>",a+="    <td>"+withdrawalArray[i].phone+"</td>",a+="    <td>"+withdrawalArray[i].email+"</td>",a+="    <td>"+withdrawalArray[i].pancard+"</td>",a+="    <td>"+withdrawalArray[i].address+"</td>",a+="    <td>"+withdrawalArray[i].accountNum+"</td>",a+="    <td>"+withdrawalArray[i].code+"</td>",a+="    <td>"+moment(withdrawalArray[i].time).format("ddd Do MMM YYYY h:mm a")+"</td>",a+="n"==withdrawalArray[i].done?'    <td sorttable_customkey="n"><button class="btn btn-default" onclick="setWithdrawalDone('+withdrawalArray[i].withdrawalID+", 'y', '"+withdrawalArray[i].username+"', '"+withdrawalArray[i].amount+"')\">Unprocessed</button></td>":'    <td sorttable_customkey="y"><button class="btn btn-default" disabled>Processed</button></td>',a+="</tr>";a+="</tbody>",$("#withdrawalTable").empty().append(a);var r=document.getElementById("withdrawalTable");sorttable.makeSortable(r)}else displayMessage("error","Error","Error: "+e[1])},"json").fail(function(){})}function changeWithdrawalPage(e){tablePages.withdrawals=e,populateWithdrawal()}function setWithdrawalDone(e,t,s,a){$.post("./php/withdrawals/setwithdrawaldone.php",{withdrawalID:e,done:t,username:s,amount:a},function(e){"success"==e?(displayMessage("info","Withdrawal has been marked as done"),populateWithdrawal()):displayMessage("error","Error","Err or deleting withdrawal. Try again later or contact web admin")}).fail(function(){})}function distribution(){"true"==sessionStorage.loggedIn&&(hideAllContainers(),setActivePage("distribution"),$("#distributionContainer").show())}function populateDistribution(){$.post("./php/distribution/getdistributionpercentages.php",{},function(e){if("success"==e[0]){var t=e[1];$("#distribution1").val(t.first),$("#distribution2").val(t.second),$("#distribution3").val(t.third),$("#distributionButton").on({click:function(){var e=parseInt($("#distribution1").val()),t=parseInt($("#distribution2").val()),s=parseInt($("#distribution3").val());e+t+s==90?$.post("./php/distribution/changepercentages.php",{first:e,second:t,third:s},function(e){"success"==e?displayMessage("info","Changes have been saved"):displayMessage("error","Error","Error")}).fail(function(){}):displayMessage("info","The percentages must add up to 100")}})}else displayMessage("error","Error","Error")},"json").fail(function(){})}function taxation(){"true"==sessionStorage.loggedIn&&(hideAllContainers(),setActivePage("taxation"),$("#taxationContainer").show())}function populateTaxation(){$.post("./php/taxation/getalltaxations.php",{},function(e){if("fail"==e)displayMessage("error","Error","Err or getting taxations");else{taxationArray=e;for(var t="",s=0;null!==taxationArray&&taxationArray.length>20&&s<taxationArray.length/20;s+=1)t+="<button class='paginationButton"+s+"' onclick='changeTaxationPage("+s+")'>"+(s+1)+"</button>";$("#createTaxationPagination").empty().append(t),$("#createTaxationPagination .paginationButton"+tablePages.taxation).addClass("active");var a="";a+="<thead>",a+="    <tr>",a+="        <th>Taxation ID</th>",a+="        <th>Username</th>",a+="        <th>Quizetos Won</th>",a+="        <th>Tax Amount</th>",a+="        <th>Net Quizetos</th>",a+="        <th>Mobile</th>",a+="        <th>Email</th>",a+="        <th>Pancard</th>",a+="    </tr>",a+="</thead>",a+="<tbody>";for(var i=20*tablePages.taxation;null!==taxationArray&&i<taxationArray.length&&i<20*(tablePages.taxation+1);i+=1)a+="<tr>",a+="    <td>"+taxationArray[i].taxID+"</td>",a+="    <td>"+taxationArray[i].username+"</td>",a+="    <td>"+taxationArray[i].grossQuizetos+"</td>",a+="    <td>"+taxationArray[i].taxAmount+"</td>",a+="    <td>"+taxationArray[i].netQuizetos+"</td>",a+="    <td>"+taxationArray[i].mobile+"</td>",a+="    <td>"+taxationArray[i].email+"</td>",a+="    <td>"+taxationArray[i].pancard+"</td>",a+="</tr>";a+="</tbody>",$("#taxationTable").empty().append(a);var r=document.getElementById("taxationTable");sorttable.makeSortable(r)}},"json").fail(function(){})}function quizMaster(){"true"==sessionStorage.loggedIn&&(hideAllContainers(),setActivePage("quizMaster"),$("#quizMasterContainer").show())}function populateQuizMaster(){$.post("./php/users/getquizmasterinfo.php",{},function(e){if("success"==e[0]){userQuizMasterArray=e[1];for(var t=e[2],s="",a=0;userQuizMasterArray.length>20&&a<userQuizMasterArray.length/20;a+=1)s+="<button class='paginationButton"+a+"' onclick='changeQuizMasterPage("+a+")'>"+(a+1)+"</button>";$("#createQuizMasterPagination").empty().append(s),$("#createQuizMasterPagination .paginationButton"+tablePages.quizMaster).addClass("active");var i,r="";if("true"===sessionStorage.quizMaster){for(r+="<thead>",r+="    <tr>",r+="        <th>Username</th>",r+="        <th>Email</th>",r+="        <th>Mobile</th>",r+="        <th>Pancard</th>",r+="        <th>Number of Approved Questions</th>",r+="        <th>Number of Rejected Questions</th>",r+="        <th>Number of quiz which can be scheduled</th>",r+="        <th>Number of quiz already scheduled</th>",r+="        <th>Balance quiz number which can be scheduled</th>",r+="        <th></th>",r+="    </tr>",r+="</thead>",r+="<tbody>",i=20*tablePages.quizMaster;null!==userQuizMasterArray&&i<userQuizMasterArray.length&&i<20*(tablePages.quizMaster+1);i+=1)locked=moment().diff(moment(userQuizMasterArray[i].lockStart))>864e5?!0:!1,r+="<tr>",r+="    <td>"+userQuizMasterArray[i].username+"</td>",r+="    <td>"+userQuizMasterArray[i].email+"</td>",r+="    <td>"+userQuizMasterArray[i].mobile+"</td>",r+="    <td>"+userQuizMasterArray[i].pancard+"</td>",r+="    <td>"+userQuizMasterArray[i].approvedQuestionCount+"</td>",r+="    <td onclick='showRejectedQuestions("+i+")'>"+userQuizMasterArray[i].rejectedQuestions.length+"</td>",r+="    <td>"+userQuizMasterArray[i].numQuizzesPurchased+"</td>",r+="    <td onclick='showScheduledQuizzes("+i+")'>"+userQuizMasterArray[i].numQuizzesScheduledQuizMaster+"</td>",r+="    <td>"+(userQuizMasterArray[i].numQuizzesPurchased-userQuizMasterArray[i].numQuizzesScheduledQuizMaster)+"</td>",r+="    <td><button class='quizMasterLockButton"+userQuizMasterArray[i].username+"' onclick='lockAccount(\""+userQuizMasterArray[i].username+'", "'+userQuizMasterArray[i].email+'", "'+userQuizMasterArray[i].rejectedQuestions.length+"\")' "+(locked?"":"style='display: none'")+">Lock</button><button class='quizMasterUnlockButton"+userQuizMasterArray[i].username+"' onclick='unlockAccount(\""+userQuizMasterArray[i].username+'", "'+userQuizMasterArray[i].email+'", "'+userQuizMasterArray[i].rejectedQuestions.length+"\")'"+(locked?"style='display: none'":"")+">Unlock</button></td>",r+="</tr>";r+="</tbody>"}else{for(r+="<thead>",r+="    <tr>",r+="        <th>Username</th>",r+="        <th>Email</th>",r+="        <th>Number of Approved Questions</th>",r+="        <th>Number of Rejected Questions</th>",r+="        <th>Number of paid quiz played</th>",r+="        <th>Number of quiz which can be scheduled </th>",r+="        <th>Number of quiz already scheduled</th>",r+="        <th>Balance quiz number which can be scheduled</th>",r+="        <th></th>",r+="    </tr>",r+="</thead>",r+="<tbody>",i=20*tablePages.quizMaster;null!==userQuizMasterArray&&i<userQuizMasterArray.length&&i<20*(tablePages.quizMaster+1);i+=1)locked=moment().diff(moment(userQuizMasterArray[i].lockStart))>864e5?!0:!1,r+="<tr>",r+="    <td>"+userQuizMasterArray[i].username+"</td>",r+="    <td>"+userQuizMasterArray[i].email+"</td>",r+="    <td>"+userQuizMasterArray[i].approvedQuestionCount+"</td>",r+="    <td onclick='showRejectedQuestions("+i+")'>"+userQuizMasterArray[i].rejectedQuestions.length+"</td>",r+="    <td>"+userQuizMasterArray[i].numQuizzesTaken+"</td>",r+="    <td>"+(parseInt(userQuizMasterArray[i].numQuizzesScheduledUser)+userQuizMasterArray[i].numQuizzesTakenRemaining/t.quizScheduleTarget)+"</td>",r+="    <td onclick='showScheduledQuizzes("+i+")'>"+userQuizMasterArray[i].numQuizzesScheduledUser+"</td>",r+="    <td>"+userQuizMasterArray[i].numQuizzesTakenRemaining/t.quizScheduleTarget+"</td>",r+="    <td><button class='quizMasterLockButton"+userQuizMasterArray[i].username+"' onclick='lockAccount(\""+userQuizMasterArray[i].username+'", "'+userQuizMasterArray[i].email+'", "'+userQuizMasterArray[i].rejectedQuestions.length+"\")' "+(locked?"":"style='display: none'")+">Lock</button><button class='quizMasterUnlockButton"+userQuizMasterArray[i].username+"' onclick='unlockAccount(\""+userQuizMasterArray[i].username+'", "'+userQuizMasterArray[i].email+'", "'+userQuizMasterArray[i].rejectedQuestions.length+"\")'"+(locked?"style='display: none'":"")+">Unlock</button></td>",r+="</tr>";r+="</tbody>"}$("#quizMasterTable").empty().append(r);var o=document.getElementById("quizMasterTable");sorttable.makeSortable(o);for(var n="",u=0;24>u;u+=1)n+="<option value='"+pad(u,2)+"'>"+get12HourTimeString(u)+"</option>";$("#quizMasterScheduleStart").empty().append(n),$("#quizMasterScheduleEnd").empty().append(n),$("#quizMasterUserScheduleTarget").val(t.quizScheduleTarget),$("#quizMasterCreatorCommission").val(t.creatorEarnings),$("#quizMasterQuizPackCost").val(t.costPerPurchase),$("#quizMasterQuizPackSize").val(t.numQuizzesPerPurchase),$("input[type='radio'][name='useAdminQuestions'][value='"+t.userQuizzesUseAdminQuestions+"']").prop("checked",!0);var l=JSON.parse(t.schedulingTimes);$("#quizMasterScheduleStart").val(l[0]),$("#quizMasterScheduleEnd").val(l[1]),$("#quizMasterSaveButton").on({click:function(){var e=JSON.stringify([$("#quizMasterScheduleStart").val(),$("#quizMasterScheduleEnd").val()]);$.post("./php/quizmaster/updatequizmasterinfo.php",{quizScheduleTarget:$("#quizMasterUserScheduleTarget").val(),creatorEarnings:$("#quizMasterCreatorCommission").val(),costPerPurchase:$("#quizMasterQuizPackCost").val(),numQuizzesPerPurchase:$("#quizMasterQuizPackSize").val(),userQuizzesUseAdminQuestions:$("input[type='radio'][name='useAdminQuestions']:checked").val(),schedulingTimes:e},function(e){"success"==e?displayMessage("info","Changes have been saved"):displayMessage("error","Error saving changes. Please contact web admin to get fixed.")}).fail(function(){})}}),$("#quizMasterUserButton").on({click:function(){sessionStorage.quizMaster="false",populateQuizMaster()}}),$("#quizMasterQuizMasterButton").on({click:function(){sessionStorage.quizMaster="true",populateQuizMaster()}})}else displayMessage("error","Error","Error: "+e[1])},"json").fail(function(){})}function changeQuizMasterPage(e){tablePages.quizMaster=e,populateQuizMaster()}function showRejectedQuestions(e){var t=userQuizMasterArray[e].rejectedQuestions,s="";s+="<table id='quizMasterRejectedQuestions'>",s+="    <tr>",s+="        <th>Question</th>",s+="        <th>Answer 1</th>",s+="        <th>Answer 2</th>",s+="        <th>Answer 3</th>",s+="        <th>Answer 4</th>",s+="        <th>Correct Answer</th>",s+="    </tr>",t.forEach(function(e){var t=JSON.parse(e.question);s+="<tr>",s+="    <td>"+t[0]+"</td>",s+="    <td>"+t[1][0]+"</td>",s+="    <td>"+t[1][1]+"</td>",s+="    <td>"+t[1][2]+"</td>",s+="    <td>"+t[1][3]+"</td>",s+="    <td>Answer "+(parseInt(t[2])+1)+"</td>",s+="</tr>"}),s+="</table>",$("#rejectedQuestionModal .modal-body").html(s),$("#rejectedQuestionModal").modal()}function showScheduledQuizzes(e){$.get("./php/quizzes/getusersscheduledquizzes.php",{username:userQuizMasterArray[e].username},function(e){if("fail"!=e.substr(0,4)){var t="";t+="<table id='quizMasterPreviouslyScheduledQuizzes'>",t+="    <tr>",t+="        <th>Quiz Name</th>",t+="        <th>Date</th>",t+="        <th>Start Time</th>",t+="        <th>Total registered users</th>",t+="        <th>Registration Fee</th>",t+="        <th>Winner</th>",t+="        <th>Earnings</th>",t+="    </tr>",JSON.parse(e).forEach(function(e){var s=moment(e.startTime).format("ddd Do MMM YYYY"),a=moment(e.startTime).format("H:mm a"),i=JSON.parse(e.userRegistered).length,r=i*e.pointsCost*(e.creatorEarnings/100);t+="<tr>",t+="    <td>"+e.category+"</td>",t+="    <td>"+s+"</td>",t+="    <td>"+a+"</td>",t+="    <td>"+i+"</td>",t+="    <td>"+e.pointsCost+"</td>",t+="    <td>"+(null===e.winner?"Hasn't finished":e.winner)+"</td>",t+="    <td>"+r+"</td>",t+="</tr>"}),t+="</table>",$("#previousQuizModal .modal-body").html(t),$("#previousQuizModal").modal()}else displayMessage("error","Error getting quizzes scheduled by this user")}).fail(function(){})}function lockAccount(e,t,s){$.post("./php/users/lockaccount.php",{username:e,email:t,numRejected:s},function(t){"success"==t?(displayMessage("success","Account has been locked"),$(".quizMasterLockButton"+e).hide(),$(".quizMasterUnlockButton"+e).show()):displayMessage("error","Error locking users account")}).fail(function(){})}function unlockAccount(e,t,s){$.post("./php/users/unlockaccount.php",{username:e,email:t,numRejected:s},function(t){"success"==t?(displayMessage("success","Account has been unlocked"),$(".quizMasterLockButton"+e).show(),$(".quizMasterUnlockButton"+e).hide()):displayMessage("error","Error locking users account")}).fail(function(){})}function pendingQuestion(){"true"==sessionStorage.loggedIn&&(hideAllContainers(),setActivePage("pendingQuestion"),$("#pendingQuestionContainer").show())}function populatePendingQuestion(){$.get("./php/pendingquestions/getallquestions.php",{},function(e){if("success"==e[0]){pendingQuestionArray=e[1];for(var t="",s=0;null!==pendingQuestionArray&&pendingQuestionArray.length>20&&s<pendingQuestionArray.length/20;s+=1)t+="<button class='paginationButton"+s+"' onclick='changePendingQuestionPage("+s+")'>"+(s+1)+"</button>";$("#createPendingQuestionPagination").empty().append(t),$("#createPendingQuestionPagination .paginationButton"+tablePages.pendingQuestion).addClass("active");var a="";a+="<thead>",a+="    <tr>",a+="        <th>Username</th>",a+="        <th>Question</th>",a+="        <th>Answers</th>",a+="        <th>Correct Answer</th>",a+="        <th></th>",a+="        <th></th>",a+="    </tr>",a+="</thead>",a+="<tbody>";for(var i=20*tablePages.pendingQuestion;null!==pendingQuestionArray&&i<pendingQuestionArray.length&&i<20*(tablePages.pendingQuestion+1);i+=1){var r=pendingQuestionArray[i],o=JSON.parse(r.question),n="ABCD",u="";o[1].forEach(function(e,t){u+=n[t]+") "+e+(4>t?"<br />":"")});var l=n[o[2]]+") "+o[1][o[2]];a+="<tr id='pendingQuestion"+i+"'>",a+="    <td>"+o[3]+"</td>",a+="    <td>"+o[0]+"</td>",a+="    <td>"+u+"</td>",a+="    <td>"+l+"</td>",a+="    <td><button onclick='acceptQuestion("+i+")'>Approve</button></td>",a+="    <td><button onclick='rejectQuestion("+i+")'>Reject</button></td>",a+="</tr>"}a+="</tbody>",$("#pendingQuestionTable").empty().append(a);var d=document.getElementById("pendingQuestionTable");sorttable.makeSortable(d)}else displayMessage("error","Error getting pending questions")},"json").fail(function(){})}function changePendingQuestionPage(e){tablePages.pendingQuestion=e,populatePendingQuestion()}function acceptQuestion(e){var t=JSON.parse(pendingQuestionArray[e].question),s=t[0],a=JSON.stringify(t[1]),i=t[2],r=t[3];$.post("./php/pendingquestions/acceptquestion.php",{questionID:pendingQuestionArray[e].questionID,question:s,answers:a,correctAnswer:i,creator:r},function(t){"success"==t?(displayMessage("info","Question approved"),$("#pendingQuestion"+e).hide()):displayMessage("error","Error accepting question")}).fail(function(){})}function rejectQuestion(e){$.post("./php/pendingquestions/rejectquestion.php",{questionID:pendingQuestionArray[e].questionID,username:pendingQuestionArray[e].username},function(e){"success"==e?displayMessage("info","Question rejected"):displayMessage("error","Error rejected question")}).fail(function(){})}function approveAllQuestions(){for(var e=0;e<pendingQuestionArray.length;e+=1)acceptQuestion(e)}var promotionArray,testimonialsArray,quizzesArray,userArray,pendingQuestionArray,place=["st","nd","rd","th"],tablePages={quizzes:0,archivedQuizzes:0,questions:0,users:0,testimonials:0,promotions:0,withdrawals:0,taxation:0,quizMaster:0,pendingQuestion:0};window.onload=function(){if(toastr.options={closeButton:!0,debug:!1,newestOnTop:!0,progressBar:!1,positionClass:"toast-top-right",preventDuplicates:!0,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},null===sessionStorage.loggedIn)sessionStorage.loggedIn="false";else if("true"==sessionStorage.loggedIn)switch(sessionStorage.page){case"users":users();break;case"quizzes":quizzes();break;case"archivedQuizzes":archivedQuizzes();break;case"questions":questions();break;case"testimonials":testimonials();break;case"promotions":promotions();break;case"withdrawal":withdrawal();break;case"distribution":distribution();break;case"taxation":taxation();break;case"quizMaster":quizMaster();break;case"pendingQuestion":pendingQuestion();break;default:users()}null===sessionStorage.page&&(sessionStorage.page="users"),void 0!==sessionStorage.fileUploaded&&("promotions"==sessionStorage.page?("success"==sessionStorage.fileUploaded?displayMessage("info","Promotion successfully added."):"sqlfail"==sessionStorage.fileUploaded.substr(0,7)?displayMessage("error","Error","Err or adding promotions to database. Please try again later."):"fileuploadfail"==sessionStorage.fileUploaded&&displayMessage("info","File upload failed. Please try again later."),sessionStorage.fileUploaded=""):"testimonials"==sessionStorage.page&&("success"==sessionStorage.fileUploaded?displayMessage("info","Testimonial successfully added."):"sqlfail"==sessionStorage.fileUploaded.substr(0,7)?displayMessage("error","Error","Err or adding promotions to database. Please try again later."):"fileuploadfail"==sessionStorage.fileUploaded&&displayMessage("info","File upload failed. Please try again later."),sessionStorage.fileUploaded="")),populateTables()};var questionsArray=[],rewards=[],rules=[],startTimePicker,endTimePicker,updateQuizID,doDisableTimeSlots=!0,selectedQAnswer=-1,updateQuestionID,allQuestionsArray,userQuizMasterArray;
